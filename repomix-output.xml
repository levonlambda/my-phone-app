This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.js
index.html
package.json
postcss.config.js
public/vite.svg
src/App.jsx
src/assets/react.svg
src/components/inventory/DeleteConfirmationModal.jsx
src/components/inventory/InventoryEditForm.jsx
src/components/inventory/InventoryFilters.jsx
src/components/inventory/InventoryRow.jsx
src/components/inventory/InventoryTable.jsx
src/components/InventoryListForm.jsx
src/components/InventorySummaryForm.jsx
src/components/phone-list/PhoneAdvancedSearch.jsx
src/components/phone-list/PhoneDetailModal.jsx
src/components/phone-selection/hooks/usePhoneCache.js
src/components/phone-selection/hooks/usePhoneOptions.js
src/components/phone-selection/PhoneAdditionalInfo.jsx
src/components/phone-selection/PhoneBasicInfo.jsx
src/components/phone-selection/PhoneColorInfo.jsx
src/components/phone-selection/PhonePriceInfo.jsx
src/components/phone-selection/PhoneSelectionForm.jsx
src/components/phone-selection/services/InventoryService.js
src/components/phone-selection/utils/phoneUtils.js
src/components/PhoneListForm.jsx
src/components/PhoneSpecCard.jsx
src/components/PhoneSpecForm.jsx
src/components/ui/badge/index.jsx
src/components/ui/badge/variants.jsx
src/components/ui/card.jsx
src/context/GlobalStateContext.jsx
src/firebase/config.js
src/index.css
src/lib/utils.js
src/main.jsx
src/styles.css
tailwind.config.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import react from 'eslint-plugin-react'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'

export default [
  { ignores: ['dist'] },
  {
    files: ['**/*.{js,jsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    settings: { react: { version: '18.3' } },
    plugins: {
      react,
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...js.configs.recommended.rules,
      ...react.configs.recommended.rules,
      ...react.configs['jsx-runtime'].rules,
      ...reactHooks.configs.recommended.rules,
      'react/jsx-no-target-blank': 'off',
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
    },
  },
]
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + React</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "my-phone-app",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@radix-ui/react-icons": "^1.3.2",
    "@radix-ui/react-slot": "^1.1.1",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "firebase": "^11.2.0",
    "lucide-react": "^0.474.0",
    "path": "^0.12.7",
    "prop-types": "^15.8.1",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-qr-code": "^2.0.15",
    "tailwind-merge": "^2.6.0",
    "url": "^0.11.4"
  },
  "devDependencies": {
    "@eslint/js": "^9.17.0",
    "@shadcn/ui": "^0.0.4",
    "@types/react": "^18.3.18",
    "@types/react-dom": "^18.3.5",
    "@vitejs/plugin-react": "^4.3.4",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.17.0",
    "eslint-plugin-react": "^7.37.2",
    "eslint-plugin-react-hooks": "^5.0.0",
    "eslint-plugin-react-refresh": "^0.4.16",
    "globals": "^15.14.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "tailwindcss-animate": "^1.0.7",
    "vite": "^6.0.5"
  }
}
</file>

<file path="postcss.config.js">
export default {
    plugins: {
      tailwindcss: {},
      autoprefixer: {},
    },
  }
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/App.jsx">
// src/App.jsx
import { useEffect } from 'react';
import PhoneSpecForm from './components/PhoneSpecForm';
import PhoneSelectionForm from './components/phone-selection/PhoneSelectionForm';
import InventoryListForm from './components/InventoryListForm';
import PhoneListForm from './components/PhoneListForm';
import InventorySummaryForm from './components/InventorySummaryForm';
// Import the hook from our consolidated file
import { useGlobalState } from './context/GlobalStateContext';

function App() {
  const { activeComponent, setActiveComponent, phoneToEdit } = useGlobalState();
  
  // For debugging
  useEffect(() => {
    console.log("App: Active component changed to:", activeComponent);
    console.log("App: phoneToEdit:", phoneToEdit ? phoneToEdit.id : 'none');
  }, [activeComponent, phoneToEdit]);

  return (
    <div className="min-h-screen bg-white">
      <div className="p-4 bg-[rgb(52,69,157)] text-white">
        <div className="max-w-6xl mx-auto flex flex-wrap gap-4">
          <button 
            className={`px-4 py-2 rounded ${activeComponent === 'summary' ? 'bg-white text-[rgb(52,69,157)]' : 'bg-transparent'}`}
            onClick={() => setActiveComponent('summary')}
          >
            Inventory Summary
          </button>
          <button 
            className={`px-4 py-2 rounded ${activeComponent === 'selection' ? 'bg-white text-[rgb(52,69,157)]' : 'bg-transparent'}`}
            onClick={() => setActiveComponent('selection')}
          >
            Select Phone
          </button>
          <button 
            className={`px-4 py-2 rounded ${activeComponent === 'form' ? 'bg-white text-[rgb(52,69,157)]' : 'bg-transparent'}`}
            onClick={() => setActiveComponent('form')}
          >
            Add New Phone
          </button>
          <button 
            className={`px-4 py-2 rounded ${activeComponent === 'inventory' ? 'bg-white text-[rgb(52,69,157)]' : 'bg-transparent'}`}
            onClick={() => setActiveComponent('inventory')}
          >
            Inventory List
          </button>
          <button 
            className={`px-4 py-2 rounded ${activeComponent === 'phonelist' ? 'bg-white text-[rgb(52,69,157)]' : 'bg-transparent'}`}
            onClick={() => setActiveComponent('phonelist')}
          >
            Phone Models
          </button>
        </div>
      </div>
      
      {activeComponent === 'summary' && <InventorySummaryForm />}
      {activeComponent === 'selection' && <PhoneSelectionForm />}
      {activeComponent === 'form' && <PhoneSpecForm />}
      {activeComponent === 'inventory' && <InventoryListForm />}
      {activeComponent === 'phonelist' && <PhoneListForm />}
    </div>
  );
}

export default App;
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/inventory/DeleteConfirmationModal.jsx">
import PropTypes from 'prop-types';
import { X } from 'lucide-react';

const DeleteConfirmationModal = ({ 
  isOpen, 
  itemToDelete, 
  onCancel, 
  onConfirm,
  isDeleting
}) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/30 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-lg max-w-md w-full p-6 mx-4">
        <div className="flex justify-between items-center mb-4">
          <h3 className="text-lg font-semibold text-gray-900">Confirm Deletion</h3>
          <button 
            onClick={onCancel}
            className="text-gray-500 hover:text-gray-700"
          >
            <X className="h-5 w-5" />
          </button>
        </div>
        
        <div className="mb-6">
          <p className="text-gray-700 mb-2">
            Are you sure you want to delete this item?
          </p>
          {itemToDelete && (
            <div className="mt-3 bg-gray-50 p-3 rounded-md">
              <p className="font-medium">
                {itemToDelete.manufacturer} {itemToDelete.model}
              </p>
              <p className="text-sm text-gray-500 mt-1">
                {itemToDelete.ram} RAM, {itemToDelete.storage} Storage, {itemToDelete.color}
              </p>
              <p className="text-sm text-gray-500 mt-1">
                IMEI: {itemToDelete.imei1}
              </p>
            </div>
          )}
          <p className="text-red-600 text-sm mt-4">
            This action cannot be undone.
          </p>
        </div>
        
        <div className="flex justify-end space-x-3">
          <button
            onClick={onCancel}
            className="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
            disabled={isDeleting}
          >
            Cancel
          </button>
          <button
            onClick={onConfirm}
            className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 flex items-center"
            disabled={isDeleting}
          >
            {isDeleting ? (
              <>
                <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Deleting...
              </>
            ) : (
              'Delete Item'
            )}
          </button>
        </div>
      </div>
    </div>
  );
};

DeleteConfirmationModal.propTypes = {
  isOpen: PropTypes.bool.isRequired,
  itemToDelete: PropTypes.object,
  onCancel: PropTypes.func.isRequired,
  onConfirm: PropTypes.func.isRequired,
  isDeleting: PropTypes.bool.isRequired
};

export default DeleteConfirmationModal;
</file>

<file path="src/components/inventory/InventoryEditForm.jsx">
import PropTypes from 'prop-types';
import { RefreshCw, Save, XCircle } from 'lucide-react';

const InventoryEditForm = ({ 
  editFormData, 
  handleEditInputChange, 
  handleSaveEdit, 
  handleCancelEdit, 
  itemId, 
  savingItemId 
}) => {
  return (
    <tr className="hover:bg-gray-50">
      <td className="border px-2 py-3 whitespace-nowrap">
        <input
          type="text"
          name="manufacturer"
          value={editFormData.manufacturer}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded"
        />
      </td>
      <td className="border px-2 py-3 whitespace-nowrap">
        <input
          type="text"
          name="model"
          value={editFormData.model}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded"
        />
      </td>
      <td className="border px-2 py-3 whitespace-nowrap">
        <input
          type="text"
          name="ram"
          value={editFormData.ram}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded"
        />
      </td>
      <td className="border px-2 py-3 whitespace-nowrap">
        <input
          type="text"
          name="storage"
          value={editFormData.storage}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded"
        />
      </td>
      <td className="border px-2 py-3 whitespace-nowrap">
        <input
          type="text"
          name="color"
          value={editFormData.color}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded"
        />
      </td>
      <td className="border px-2 py-3 text-right whitespace-nowrap">
        <input
          type="text"
          name="retailPrice"
          value={editFormData.retailPrice}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded text-right"
        />
      </td>
      <td className="border px-2 py-3 font-mono whitespace-nowrap">
        <input
          type="text"
          name="imei1"
          value={editFormData.imei1}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded font-mono"
        />
      </td>
      <td className="border px-2 py-3 font-mono whitespace-nowrap">
        <input
          type="text"
          name="barcode"
          value={editFormData.barcode}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded font-mono"
        />
      </td>
      <td className="border px-2 py-3 text-center whitespace-nowrap">
        <select
          name="status"
          value={editFormData.status}
          onChange={handleEditInputChange}
          className="w-full p-1 border rounded text-center"
        >
          <option value="On-Hand">On-Hand</option>
          <option value="On-Display">On-Display</option>
          <option value="Sold">Sold</option>
          <option value="Reserved">Reserved</option>
          <option value="Defective">Defective</option>
        </select>
      </td>
      <td className="border px-2 py-3 text-center whitespace-nowrap">
        <div className="flex justify-center space-x-2">
          <button
            onClick={() => handleSaveEdit(itemId)}
            disabled={savingItemId === itemId}
            className="p-1 text-green-600 hover:text-green-800"
            title="Save changes"
          >
            {savingItemId === itemId ? (
              <RefreshCw className="h-5 w-5 animate-spin" />
            ) : (
              <Save className="h-5 w-5" />
            )}
          </button>
          <button
            onClick={handleCancelEdit}
            className="p-1 text-red-600 hover:text-red-800"
            title="Cancel edit"
          >
            <XCircle className="h-5 w-5" />
          </button>
        </div>
      </td>
    </tr>
  );
};

InventoryEditForm.propTypes = {
  editFormData: PropTypes.object.isRequired,
  handleEditInputChange: PropTypes.func.isRequired,
  handleSaveEdit: PropTypes.func.isRequired,
  handleCancelEdit: PropTypes.func.isRequired,
  itemId: PropTypes.string.isRequired,
  savingItemId: PropTypes.string
};

export default InventoryEditForm;
</file>

<file path="src/components/inventory/InventoryFilters.jsx">
import PropTypes from 'prop-types';
import { useEffect, useState } from 'react';
import { collection, getDocs, query, where } from 'firebase/firestore';
import { db } from '../../firebase/config';

const InventoryFilters = ({ 
  filters, 
  pendingFilters, 
  filterOptions, 
  handleFilterChange,
  allItems
}) => {
  // State for filtered options based on selections
  const [filteredModels, setFilteredModels] = useState([]);
  const [filteredRams, setFilteredRams] = useState([]);
  const [filteredStorages, setFilteredStorages] = useState([]);
  const [filteredColors, setFilteredColors] = useState([]);
  
  // Loading states
  const [isLoadingModels, setIsLoadingModels] = useState(false);
  const [isLoadingRams, setIsLoadingRams] = useState(false);
  const [isLoadingStorages, setIsLoadingStorages] = useState(false);
  const [isLoadingColors, setIsLoadingColors] = useState(false);

  // Load models for selected manufacturer from database
  const loadModelsForManufacturer = async (manufacturer) => {
    if (!manufacturer) return;
    
    setIsLoadingModels(true);
    try {
      const inventoryRef = collection(db, 'inventory');
      const q = query(inventoryRef, where("manufacturer", "==", manufacturer));
      const snapshot = await getDocs(q);
      
      // Extract unique models
      const models = [...new Set(
        snapshot.docs.map(doc => doc.data().model)
      )].filter(Boolean).sort();
      
      setFilteredModels(models);
    } catch (error) {
      console.error("Error loading models:", error);
    } finally {
      setIsLoadingModels(false);
    }
  };

  // Load RAM options based on manufacturer and model
  const loadRamOptions = async (manufacturer, model) => {
    if (!manufacturer || !model) return;
    
    setIsLoadingRams(true);
    try {
      const inventoryRef = collection(db, 'inventory');
      const q = query(
        inventoryRef, 
        where("manufacturer", "==", manufacturer),
        where("model", "==", model)
      );
      const snapshot = await getDocs(q);
      
      // Extract unique RAM options
      const rams = [...new Set(
        snapshot.docs.map(doc => doc.data().ram)
      )].filter(Boolean).sort();
      
      setFilteredRams(rams);
    } catch (error) {
      console.error("Error loading RAM options:", error);
    } finally {
      setIsLoadingRams(false);
    }
  };

  // Load storage options based on manufacturer, model, and RAM
  const loadStorageOptions = async (manufacturer, model, ram) => {
    if (!manufacturer || !model) return;
    
    setIsLoadingStorages(true);
    try {
      let q;
      const inventoryRef = collection(db, 'inventory');
      
      if (ram) {
        // If RAM is selected, include it in the query
        q = query(
          inventoryRef, 
          where("manufacturer", "==", manufacturer),
          where("model", "==", model),
          where("ram", "==", ram)
        );
      } else {
        // If RAM is not selected, just filter by manufacturer and model
        q = query(
          inventoryRef, 
          where("manufacturer", "==", manufacturer),
          where("model", "==", model)
        );
      }
      
      const snapshot = await getDocs(q);
      
      // Extract unique storage options
      const storages = [...new Set(
        snapshot.docs.map(doc => doc.data().storage)
      )].filter(Boolean).sort();
      
      setFilteredStorages(storages);
    } catch (error) {
      console.error("Error loading storage options:", error);
    } finally {
      setIsLoadingStorages(false);
    }
  };

  // Load color options based on manufacturer, model, RAM, and storage
  const loadColorOptions = async (manufacturer, model, ram, storage) => {
    if (!manufacturer || !model) return;
    
    setIsLoadingColors(true);
    try {
      let q;
      const inventoryRef = collection(db, 'inventory');
      
      // Build query based on selected filters
      const constraints = [
        where("manufacturer", "==", manufacturer),
        where("model", "==", model)
      ];
      
      if (ram) {
        constraints.push(where("ram", "==", ram));
      }
      
      if (storage) {
        constraints.push(where("storage", "==", storage));
      }
      
      q = query(inventoryRef, ...constraints);
      const snapshot = await getDocs(q);
      
      // Extract unique color options
      const colors = [...new Set(
        snapshot.docs.map(doc => doc.data().color)
      )].filter(Boolean).sort();
      
      setFilteredColors(colors);
    } catch (error) {
      console.error("Error loading color options:", error);
    } finally {
      setIsLoadingColors(false);
    }
  };

  // Update models when manufacturer changes
  useEffect(() => {
    if (filters.manufacturer) {
      if (allItems && allItems.length > 0) {
        // If allItems is populated, filter models from it
        const modelsForManufacturer = [...new Set(
          allItems
            .filter(item => item.manufacturer === filters.manufacturer)
            .map(item => item.model)
        )].sort();
        
        // Only update if we found models
        if (modelsForManufacturer.length > 0) {
          setFilteredModels(modelsForManufacturer);
        } else {
          // If no models found in allItems, load from database
          loadModelsForManufacturer(filters.manufacturer);
        }
      } else {
        // If allItems is not available, load from database
        loadModelsForManufacturer(filters.manufacturer);
      }
    } else {
      // If no manufacturer is selected, show all models
      setFilteredModels(filterOptions.models);
    }
  }, [filters.manufacturer, allItems, filterOptions.models]);

  // Update RAM options when manufacturer and model change
  useEffect(() => {
    if (filters.manufacturer && filters.model) {
      if (allItems && allItems.length > 0) {
        // If allItems is populated, filter RAM options from it
        const ramsForModel = [...new Set(
          allItems
            .filter(item => 
              item.manufacturer === filters.manufacturer && 
              item.model === filters.model
            )
            .map(item => item.ram)
        )].sort();
        
        // Only update if we found RAM options
        if (ramsForModel.length > 0) {
          setFilteredRams(ramsForModel);
        } else {
          // If no RAM options found in allItems, load from database
          loadRamOptions(filters.manufacturer, filters.model);
        }
      } else {
        // If allItems is not available, load from database
        loadRamOptions(filters.manufacturer, filters.model);
      }
    } else {
      // If no manufacturer or model is selected, show all RAM options
      setFilteredRams(filterOptions.rams);
    }
  }, [filters.manufacturer, filters.model, allItems, filterOptions.rams]);

  // Update Storage options when manufacturer, model, and RAM change
  useEffect(() => {
    if (filters.manufacturer && filters.model) {
      if (allItems && allItems.length > 0) {
        // Filter items by current selections
        let filteredItems = allItems.filter(item => 
          item.manufacturer === filters.manufacturer && 
          item.model === filters.model
        );
        
        // If RAM is selected, filter by that too
        if (filters.ram) {
          filteredItems = filteredItems.filter(item => item.ram === filters.ram);
        }
        
        // Extract unique storage options
        const storagesForSelection = [...new Set(
          filteredItems.map(item => item.storage)
        )].sort();
        
        // Only update if we found storage options
        if (storagesForSelection.length > 0) {
          setFilteredStorages(storagesForSelection);
        } else {
          // If no storage options found in allItems, load from database
          loadStorageOptions(filters.manufacturer, filters.model, filters.ram);
        }
      } else {
        // If allItems is not available, load from database
        loadStorageOptions(filters.manufacturer, filters.model, filters.ram);
      }
    } else {
      // If no manufacturer or model is selected, show all storage options
      setFilteredStorages(filterOptions.storages);
    }
  }, [filters.manufacturer, filters.model, filters.ram, allItems, filterOptions.storages]);

  // Update Color options when manufacturer, model, RAM, and storage change
  useEffect(() => {
    if (filters.manufacturer && filters.model) {
      if (allItems && allItems.length > 0) {
        // Filter items by current selections
        let filteredItems = allItems.filter(item => 
          item.manufacturer === filters.manufacturer && 
          item.model === filters.model
        );
        
        // Apply additional filters if selected
        if (filters.ram) {
          filteredItems = filteredItems.filter(item => item.ram === filters.ram);
        }
        
        if (filters.storage) {
          filteredItems = filteredItems.filter(item => item.storage === filters.storage);
        }
        
        // Extract unique color options
        const colorsForSelection = [...new Set(
          filteredItems.map(item => item.color)
        )].sort();
        
        // Only update if we found color options
        if (colorsForSelection.length > 0) {
          setFilteredColors(colorsForSelection);
        } else {
          // If no color options found in allItems, load from database
          loadColorOptions(filters.manufacturer, filters.model, filters.ram, filters.storage);
        }
      } else {
        // If allItems is not available, load from database
        loadColorOptions(filters.manufacturer, filters.model, filters.ram, filters.storage);
      }
    } else {
      // If no manufacturer or model is selected, show all color options
      setFilteredColors(filterOptions.colors);
    }
  }, [
    filters.manufacturer, 
    filters.model, 
    filters.ram, 
    filters.storage, 
    allItems, 
    filterOptions.colors
  ]);

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {/* Manufacturer filter */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Manufacturer
        </label>
        <select
          name="manufacturer"
          value={filters.manufacturer}
          onChange={handleFilterChange}
          className="w-full p-2 border rounded"
        >
          <option value="">All Manufacturers</option>
          {filterOptions.manufacturers.map(manufacturer => (
            <option key={manufacturer} value={manufacturer}>
              {manufacturer}
            </option>
          ))}
        </select>
      </div>
      
      {/* Model filter */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Model
        </label>
        <select
          name="model"
          value={filters.model}
          onChange={handleFilterChange}
          className="w-full p-2 border rounded"
          disabled={!filters.manufacturer || isLoadingModels}
        >
          <option value="">All Models</option>
          {isLoadingModels ? (
            <option value="" disabled>Loading models...</option>
          ) : (
            filteredModels.map(model => (
              <option key={model} value={model}>
                {model}
              </option>
            ))
          )}
        </select>
        {isLoadingModels && (
          <p className="text-xs text-gray-500 mt-1">Loading models...</p>
        )}
        {!filters.manufacturer && (
          <p className="text-xs text-gray-500 mt-1">Select a manufacturer first</p>
        )}
      </div>
      
      {/* Status filter */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Status
        </label>
        <select
          name="status"
          value={filters.status}
          onChange={handleFilterChange}
          className="w-full p-2 border rounded"
        >
          <option value="">All Statuses</option>
          {filterOptions.statuses.map(status => (
            <option key={status} value={status}>
              {status}
            </option>
          ))}
        </select>
      </div>
      
      {/* RAM filter */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          RAM
        </label>
        <select
          name="ram"
          value={filters.ram}
          onChange={handleFilterChange}
          className="w-full p-2 border rounded"
          disabled={!filters.manufacturer || !filters.model || isLoadingRams}
        >
          <option value="">All RAM</option>
          {isLoadingRams ? (
            <option value="" disabled>Loading RAM options...</option>
          ) : (
            filteredRams.map(ram => (
              <option key={ram} value={ram}>
                {ram}
              </option>
            ))
          )}
        </select>
        {isLoadingRams && (
          <p className="text-xs text-gray-500 mt-1">Loading RAM options...</p>
        )}
        {(!filters.manufacturer || !filters.model) && (
          <p className="text-xs text-gray-500 mt-1">Select manufacturer and model first</p>
        )}
      </div>
      
      {/* Storage filter */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Storage
        </label>
        <select
          name="storage"
          value={filters.storage}
          onChange={handleFilterChange}
          className="w-full p-2 border rounded"
          disabled={!filters.manufacturer || !filters.model || isLoadingStorages}
        >
          <option value="">All Storage</option>
          {isLoadingStorages ? (
            <option value="" disabled>Loading storage options...</option>
          ) : (
            filteredStorages.map(storage => (
              <option key={storage} value={storage}>
                {storage}
              </option>
            ))
          )}
        </select>
        {isLoadingStorages && (
          <p className="text-xs text-gray-500 mt-1">Loading storage options...</p>
        )}
        {(!filters.manufacturer || !filters.model) && (
          <p className="text-xs text-gray-500 mt-1">Select manufacturer and model first</p>
        )}
      </div>
      
      {/* Color filter */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Color
        </label>
        <select
          name="color"
          value={filters.color}
          onChange={handleFilterChange}
          className="w-full p-2 border rounded"
          disabled={!filters.manufacturer || !filters.model || isLoadingColors}
        >
          <option value="">All Colors</option>
          {isLoadingColors ? (
            <option value="" disabled>Loading color options...</option>
          ) : (
            filteredColors.map(color => (
              <option key={color} value={color}>
                {color}
              </option>
            ))
          )}
        </select>
        {isLoadingColors && (
          <p className="text-xs text-gray-500 mt-1">Loading color options...</p>
        )}
        {(!filters.manufacturer || !filters.model) && (
          <p className="text-xs text-gray-500 mt-1">Select manufacturer and model first</p>
        )}
      </div>
      
      {/* IMEI1 filter */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          IMEI1
        </label>
        <input
          type="text"
          name="imei1"
          value={pendingFilters.imei1}
          onChange={handleFilterChange}
          placeholder="Search IMEI"
          className="w-full p-2 border rounded"
        />
      </div>
      
      {/* Barcode filter */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Barcode
        </label>
        <input
          type="text"
          name="barcode"
          value={pendingFilters.barcode}
          onChange={handleFilterChange}
          placeholder="Search barcode"
          className="w-full p-2 border rounded"
        />
      </div>
      
      {/* Price range */}
      <div className="flex gap-2">
        <div className="flex-1">
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Min Price
          </label>
          <input
            type="text"
            name="minPrice"
            value={pendingFilters.minPrice}
            onChange={handleFilterChange}
            placeholder="0"
            className="w-full p-2 border rounded"
          />
        </div>
        <div className="flex-1">
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Max Price
          </label>
          <input
            type="text"
            name="maxPrice"
            value={pendingFilters.maxPrice}
            onChange={handleFilterChange}
            placeholder="999,999"
            className="w-full p-2 border rounded"
          />
        </div>
      </div>
    </div>
  );
};

InventoryFilters.propTypes = {
  filters: PropTypes.object.isRequired,
  pendingFilters: PropTypes.object.isRequired,
  filterOptions: PropTypes.object.isRequired,
  handleFilterChange: PropTypes.func.isRequired,
  allItems: PropTypes.array.isRequired
};

export default InventoryFilters;
</file>

<file path="src/components/inventory/InventoryRow.jsx">
import PropTypes from 'prop-types';
import { Edit } from 'lucide-react';
import { Trash2 } from 'lucide-react';

const InventoryRow = ({ 
  item, 
  formatNumberWithCommas, 
  handleEditClick, 
  handleDeleteClick 
}) => {
  return (
    <tr className="hover:bg-gray-50">
      <td className="border px-2 py-3 whitespace-nowrap">{item.manufacturer}</td>
      <td className="border px-2 py-3 whitespace-nowrap">{item.model}</td>
      <td className="border px-2 py-3 whitespace-nowrap">{item.ram}</td>
      <td className="border px-2 py-3 whitespace-nowrap">{item.storage}</td>
      <td className="border px-2 py-3 whitespace-nowrap">{item.color}</td>
      <td className="border px-2 py-3 text-right whitespace-nowrap">
        {formatNumberWithCommas(item.retailPrice)}
      </td>
      <td className="border px-2 py-3 font-mono whitespace-nowrap">{item.imei1}</td>
      <td className="border px-2 py-3 font-mono whitespace-nowrap">{item.barcode || '-'}</td>
      <td className="border px-2 py-3 text-center whitespace-nowrap">
        <span className={`inline-block px-3 py-1 rounded-full text-sm ${
          item.status === 'On-Hand' ? 'bg-green-100 text-green-800' :
          item.status === 'On-Display' ? 'bg-blue-100 text-blue-800' :
          item.status === 'Sold' ? 'bg-red-100 text-red-800' :
          item.status === 'Reserved' ? 'bg-yellow-100 text-yellow-800' :
          'bg-gray-100 text-gray-800'
        }`}>
          {item.status}
        </span>
      </td>
      <td className="border px-2 py-3 text-center whitespace-nowrap">
        <div className="flex justify-center space-x-2">
          <button
            onClick={() => handleEditClick(item)}
            className="p-1 text-blue-600 hover:text-blue-800"
            title="Edit item"
          >
            <Edit className="h-5 w-5" />
          </button>
          <button
            onClick={() => handleDeleteClick(item.id)}
            className="p-1 text-red-600 hover:text-red-800"
            title="Delete item"
          >
            <Trash2 className="h-5 w-5" />
          </button>
        </div>
      </td>
    </tr>
  );
};

InventoryRow.propTypes = {
  item: PropTypes.shape({
    id: PropTypes.string.isRequired,
    manufacturer: PropTypes.string.isRequired,
    model: PropTypes.string.isRequired,
    ram: PropTypes.string.isRequired,
    storage: PropTypes.string.isRequired,
    color: PropTypes.string.isRequired,
    retailPrice: PropTypes.number.isRequired,
    imei1: PropTypes.string.isRequired,
    barcode: PropTypes.string,
    status: PropTypes.string.isRequired
  }).isRequired,
  formatNumberWithCommas: PropTypes.func.isRequired,
  handleEditClick: PropTypes.func.isRequired,
  handleDeleteClick: PropTypes.func.isRequired
};

export default InventoryRow;
</file>

<file path="src/components/inventory/InventoryTable.jsx">
import { useState } from 'react';
import PropTypes from 'prop-types';
import { doc, updateDoc, runTransaction, increment, deleteDoc } from 'firebase/firestore';
import { db } from '../../firebase/config';
import InventoryRow from './InventoryRow';
import InventoryEditForm from './InventoryEditForm';
import DeleteConfirmationModal from './DeleteConfirmationModal';

const InventoryTable = ({ 
  inventoryItems, 
  handleSort, 
  sortField, 
  sortDirection, 
  formatNumberWithCommas,
  allItems,
  setAllItems,
  setInventoryItems,
  applyFilters
}) => {
  const [editingItemId, setEditingItemId] = useState(null);
  const [editFormData, setEditFormData] = useState({
    manufacturer: '',
    model: '',
    ram: '',
    storage: '',
    color: '',
    retailPrice: '',
    imei1: '',
    barcode: '',
    status: ''
  });
  const [savingItemId, setSavingItemId] = useState(null);
  const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
  const [itemToDelete, setItemToDelete] = useState(null);
  const [isDeleting, setIsDeleting] = useState(false);

  // Parse price value for filters
  const parsePrice = (value) => {
    if (!value) return '';
    return value.replace(/,/g, '');
  };

  // Handle edit button click
  const handleEditClick = (item) => {
    // If we're already editing, cancel it first
    if (editingItemId) {
      setEditingItemId(null);
    }
    
    // Set the item to edit
    setEditingItemId(item.id);
    
    // Populate form with item data
    setEditFormData({
      manufacturer: item.manufacturer,
      model: item.model,
      ram: item.ram,
      storage: item.storage,
      color: item.color,
      retailPrice: formatNumberWithCommas(item.retailPrice),
      imei1: item.imei1,
      barcode: item.barcode || '',
      status: item.status
    });
  };

  // Handle delete button click
  const handleDeleteClick = (itemId) => {
    const item = allItems.find(item => item.id === itemId);
    if (item) {
      setItemToDelete(item);
      setIsDeleteModalOpen(true);
    }
  };

  // Handle delete confirmation
  const handleDeleteConfirm = async () => {
    if (!itemToDelete) return;
    
    setIsDeleting(true);
    
    try {
      // Get a reference to the document
      const itemRef = doc(db, 'inventory', itemToDelete.id);
      
      // Delete the document
      await deleteDoc(itemRef);
      
      // Update inventory counts
      const inventoryId = `${itemToDelete.manufacturer}_${itemToDelete.model}_${itemToDelete.ram}_${itemToDelete.storage}_${itemToDelete.color}`.replace(/\s+/g, '_').toLowerCase();
      
      // Reference to the inventory count doc
      const inventoryRef = doc(db, 'inventory_counts', inventoryId);
      
      // Update inventory counts based on the item's status
      await runTransaction(db, async (transaction) => {
        const inventoryDoc = await transaction.get(inventoryRef);
        
        if (inventoryDoc.exists()) {
          // Determine which field to decrement based on status
          const decrementField = 
            itemToDelete.status === 'On-Hand' ? 'onHand' : 
            itemToDelete.status === 'On-Display' ? 'onDisplay' : 
            itemToDelete.status === 'Sold' ? 'sold' : 
            itemToDelete.status === 'Reserved' ? 'reserved' : 
            'defective';
          
          // Decrement total and status count
          transaction.update(inventoryRef, {
            total: increment(-1),
            [decrementField]: increment(-1),
            lastUpdated: new Date().toLocaleDateString()
          });
        }
      });
      
      // Update local state by removing the deleted item
      const updatedItems = allItems.filter(item => item.id !== itemToDelete.id);
      setAllItems(updatedItems);
      
      // Re-apply filters
      const filteredItems = applyFilters(updatedItems);
      setInventoryItems(filteredItems);
      
      // Close the modal and reset state
      setIsDeleteModalOpen(false);
      setItemToDelete(null);
      setIsDeleting(false);
      
    } catch (error) {
      console.error("Error deleting item:", error);
      alert(`Error deleting item: ${error.message}`);
      setIsDeleting(false);
    }
  };

  // Handle cancel delete
  const handleDeleteCancel = () => {
    setIsDeleteModalOpen(false);
    setItemToDelete(null);
  };

  // Handle cancel edit
  const handleCancelEdit = () => {
    setEditingItemId(null);
    setEditFormData({
      manufacturer: '',
      model: '',
      ram: '',
      storage: '',
      color: '',
      retailPrice: '',
      imei1: '',
      barcode: '',
      status: ''
    });
  };

  // Handle edit form input changes
  const handleEditInputChange = (e) => {
    const { name, value } = e.target;
    
    if (name === 'retailPrice') {
      // Format price with commas
      const sanitizedValue = value.replace(/[^\d,]/g, '');
      const formattedValue = formatNumberWithCommas(sanitizedValue);
      
      setEditFormData(prev => ({
        ...prev,
        [name]: formattedValue
      }));
    } else {
      setEditFormData(prev => ({
        ...prev,
        [name]: value
      }));
    }
  };

  // Handle save edits
  const handleSaveEdit = async (id) => {
    setSavingItemId(id);
    
    try {
      // Remove commas from price and convert to number
      const retailPrice = parseFloat(parsePrice(editFormData.retailPrice)) || 0;
      
      // Create an update object with the edited fields
      const updateData = {
        manufacturer: editFormData.manufacturer,
        model: editFormData.model,
        ram: editFormData.ram,
        storage: editFormData.storage,
        color: editFormData.color,
        retailPrice: retailPrice,
        imei1: editFormData.imei1,
        barcode: editFormData.barcode,
        status: editFormData.status
      };
      
      // Get a reference to the document
      const itemRef = doc(db, 'inventory', id);
      
      // Update the document
      await updateDoc(itemRef, updateData);
      
      // If the status was changed, update the inventory counts
      const originalItem = allItems.find(item => item.id === id);
      if (originalItem && originalItem.status !== editFormData.status) {
        // Create a unique ID for this inventory item type
        const inventoryId = `${editFormData.manufacturer}_${editFormData.model}_${editFormData.ram}_${editFormData.storage}_${editFormData.color}`.replace(/\s+/g, '_').toLowerCase();
        
        // Reference to the inventory count doc
        const inventoryRef = doc(db, 'inventory_counts', inventoryId);
        
        // Run as a transaction to ensure data consistency
        await runTransaction(db, async (transaction) => {
          const inventoryDoc = await transaction.get(inventoryRef);
          
          if (inventoryDoc.exists()) {
            // Decrement the old status count
            const decrementField = 
              originalItem.status === 'On-Hand' ? 'onHand' : 
              originalItem.status === 'On-Display' ? 'onDisplay' : 
              originalItem.status === 'Sold' ? 'sold' : 
              originalItem.status === 'Reserved' ? 'reserved' : 
              'defective';
            
            // Increment the new status count
            const incrementField = 
              editFormData.status === 'On-Hand' ? 'onHand' : 
              editFormData.status === 'On-Display' ? 'onDisplay' : 
              editFormData.status === 'Sold' ? 'sold' : 
              editFormData.status === 'Reserved' ? 'reserved' : 
              'defective';
            
            // Update counters
            transaction.update(inventoryRef, {
              [decrementField]: increment(-1),
              [incrementField]: increment(1),
              lastUpdated: new Date().toLocaleDateString()
            });
          }
        });
      }
      
      // Update local state
      setAllItems(prevItems => 
        prevItems.map(item => 
          item.id === id 
            ? { 
                ...item, 
                ...updateData,
                // Keep original dealersPrice since we're not editing it
                dealersPrice: item.dealersPrice
              } 
            : item
        )
      );
      
      // Reset editing state
      setEditingItemId(null);
      setSavingItemId(null);
      
      // Re-apply filters to update the displayed inventory items
      const updatedItems = allItems.map(item => 
        item.id === id 
          ? { 
              ...item, 
              ...updateData,
              // Keep original dealersPrice since we're not editing it
              dealersPrice: item.dealersPrice
            } 
          : item
      );
      const filteredItems = applyFilters(updatedItems);
      setInventoryItems(filteredItems);
      
    } catch (error) {
      console.error("Error updating item:", error);
      alert(`Error updating item: ${error.message}`);
      setSavingItemId(null);
    }
  };
  
  // Sort the inventory items based on sortField and sortDirection
  const sortedInventoryItems = [...inventoryItems].sort((a, b) => {
    // Handle numeric fields
    if (sortField === 'retailPrice') {
      if (sortDirection === 'asc') {
        return a.retailPrice - b.retailPrice;
      } else {
        return b.retailPrice - a.retailPrice;
      }
    }
    
    // Handle string fields
    if (sortDirection === 'asc') {
      return a[sortField]?.localeCompare(b[sortField] || '');
    } else {
      return b[sortField]?.localeCompare(a[sortField] || '');
    }
  });

  return (
    <div className="overflow-x-auto">
      <table className="w-full border-collapse text-base">
        <thead>
          <tr className="bg-gray-100">
            <th 
              className="border px-2 py-3 text-left cursor-pointer hover:bg-gray-200 font-semibold"
              onClick={() => handleSort('manufacturer')}
              style={{ width: '12%' }}
            >
              Manufacturer
              {sortField === 'manufacturer' && (
                <span className="ml-1">{sortDirection === 'asc' ? '' : ''}</span>
              )}
            </th>
            <th 
              className="border px-2 py-3 text-left cursor-pointer hover:bg-gray-200 font-semibold"
              onClick={() => handleSort('model')}
              style={{ width: '12%' }}
            >
              Model
              {sortField === 'model' && (
                <span className="ml-1">{sortDirection === 'asc' ? '' : ''}</span>
              )}
            </th>
            <th className="border px-2 py-3 text-left font-semibold" style={{ width: '6%' }}>RAM</th>
            <th className="border px-2 py-3 text-left font-semibold" style={{ width: '7%' }}>Storage</th>
            <th className="border px-2 py-3 text-left font-semibold" style={{ width: '12%' }}>Color</th>
            <th 
              className="border px-2 py-3 text-right cursor-pointer hover:bg-gray-200 font-semibold"
              onClick={() => handleSort('retailPrice')}
              style={{ width: '7%' }}
            >
              Price
              {sortField === 'retailPrice' && (
                <span className="ml-1">{sortDirection === 'asc' ? '' : ''}</span>
              )}
            </th>
            <th className="border px-2 py-3 text-left font-semibold" style={{ width: '15%' }}>IMEI1</th>
            <th className="border px-2 py-3 text-left font-semibold" style={{ width: '15%' }}>Barcode</th>
            <th 
              className="border px-2 py-3 text-center cursor-pointer hover:bg-gray-200 font-semibold"
              onClick={() => handleSort('status')}
              style={{ width: '8%' }}
            >
              Status
              {sortField === 'status' && (
                <span className="ml-1">{sortDirection === 'asc' ? '' : ''}</span>
              )}
            </th>
            <th className="border px-2 py-3 text-center font-semibold" style={{ width: '6%' }}>Action</th>
          </tr>
        </thead>
        <tbody>
          {sortedInventoryItems.map((item) => (
            editingItemId === item.id ? (
              <InventoryEditForm 
                key={item.id}
                itemId={item.id}
                editFormData={editFormData}
                handleEditInputChange={handleEditInputChange}
                handleSaveEdit={handleSaveEdit}
                handleCancelEdit={handleCancelEdit}
                savingItemId={savingItemId}
              />
            ) : (
              <InventoryRow 
                key={item.id}
                item={item}
                formatNumberWithCommas={formatNumberWithCommas}
                handleEditClick={handleEditClick}
                handleDeleteClick={handleDeleteClick}
              />
            )
          ))}
        </tbody>
      </table>

      {/* Delete confirmation modal */}
      <DeleteConfirmationModal
        isOpen={isDeleteModalOpen}
        itemToDelete={itemToDelete}
        onCancel={handleDeleteCancel}
        onConfirm={handleDeleteConfirm}
        isDeleting={isDeleting}
      />
    </div>
  );
};

InventoryTable.propTypes = {
  inventoryItems: PropTypes.array.isRequired,
  handleSort: PropTypes.func.isRequired,
  sortField: PropTypes.string.isRequired,
  sortDirection: PropTypes.string.isRequired,
  formatNumberWithCommas: PropTypes.func.isRequired,
  allItems: PropTypes.array.isRequired,
  setAllItems: PropTypes.func.isRequired,
  setInventoryItems: PropTypes.func.isRequired,
  applyFilters: PropTypes.func.isRequired
};

export default InventoryTable;
</file>

<file path="src/components/InventoryListForm.jsx">
import { useState, useEffect, useCallback, useRef } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { collection, getDocs, query, orderBy, where } from 'firebase/firestore';
import { db } from '../firebase/config';
import { Smartphone, RefreshCw, Filter, X, Search } from 'lucide-react';
import InventoryTable from './inventory/InventoryTable';
import InventoryFilters from './inventory/InventoryFilters';

const InventoryListForm = () => {
  // State for inventory data
  const [inventoryItems, setInventoryItems] = useState([]);
  const [allItems, setAllItems] = useState([]); // Store all unfiltered items
  const [loading, setLoading] = useState(false); // Changed to false by default
  const [error, setError] = useState(null);
  const [sortField, setSortField] = useState('manufacturer');
  const [sortDirection, setSortDirection] = useState('asc');
  const [initialLoad, setInitialLoad] = useState(true); // Track if data has been loaded
  
  // State for filters
  const [filters, setFilters] = useState({
    manufacturer: '',
    model: '',
    ram: '',
    storage: '',
    status: '',
    minPrice: '',
    maxPrice: '',
    color: '',
    imei1: '',
    barcode: ''
  });
  
  // Separate state for pending filter changes (before debounce)
  const [pendingFilters, setPendingFilters] = useState({
    minPrice: '',
    maxPrice: '',
    imei1: '',
    barcode: ''
  });
  
  // Filter options lists
  const [filterOptions, setFilterOptions] = useState({
    manufacturers: [],
    models: [],
    rams: [],
    storages: [],
    colors: [],
    statuses: ['On-Hand', 'On-Display', 'Sold', 'Reserved', 'Defective']
  });
  
  // Show/hide filters
  const [showFilters, setShowFilters] = useState(true); // Default to showing filters
  
  // Debounce timer ref
  const debounceTimerRef = useRef(null);

  // Format number with commas
  const formatNumberWithCommas = (value) => {
    if (!value && value !== 0) return '';
    return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  };
  
  // Parse price value for filters
  const parsePrice = (value) => {
    if (!value) return '';
    return value.replace(/,/g, '');
  };
  
  // Sync filters to pendingFilters when filters change
  useEffect(() => {
    setPendingFilters(prevPending => ({
      ...prevPending,
      minPrice: filters.minPrice,
      maxPrice: filters.maxPrice,
      imei1: filters.imei1,
      barcode: filters.barcode
    }));
  }, [filters.minPrice, filters.maxPrice, filters.imei1, filters.barcode]);

  // Handle filter change
  const handleFilterChange = (e) => {
    const { name, value } = e.target;
    
    // For debounced text inputs (price fields, imei, barcode)
    if (name === 'minPrice' || name === 'maxPrice' || name === 'imei1' || name === 'barcode') {
      // For price fields, handle numeric input
      if (name === 'minPrice' || name === 'maxPrice') {
        // Allow only numbers and commas
        const sanitizedValue = value.replace(/[^\d,]/g, '');
        const formattedValue = formatNumberWithCommas(sanitizedValue);
        
        // Update pending value first (for display)
        setPendingFilters(prev => ({
          ...prev,
          [name]: formattedValue
        }));
        
        // Clear any existing timer
        if (debounceTimerRef.current) {
          clearTimeout(debounceTimerRef.current);
        }
        
        // Set a new timer to update the actual filter after delay
        debounceTimerRef.current = setTimeout(() => {
          setFilters(prev => ({
            ...prev,
            [name]: formattedValue
          }));
        }, 800); // 800ms delay
      } else {
        // For text search fields (IMEI, barcode)
        setPendingFilters(prev => ({
          ...prev,
          [name]: value
        }));
        
        // Clear any existing timer
        if (debounceTimerRef.current) {
          clearTimeout(debounceTimerRef.current);
        }
        
        // Set a new timer to update the actual filter after delay
        debounceTimerRef.current = setTimeout(() => {
          setFilters(prev => ({
            ...prev,
            [name]: value
          }));
        }, 500); // 500ms delay
      }
    } else {
      // For dropdown selects (instant filtering)
      setFilters(prev => ({
        ...prev,
        [name]: value
      }));
      
      // Reset color when manufacturer or model changes
      if (name === 'manufacturer' || name === 'model') {
        setFilters(prev => ({
          ...prev,
          color: '',
          [name]: value
        }));
      }
    }
  };

  // Clear all filters
  const clearFilters = () => {
    // Clear both actual filters and pending filters
    setFilters({
      manufacturer: '',
      model: '',
      ram: '',
      storage: '',
      status: '',
      minPrice: '',
      maxPrice: '',
      color: '',
      imei1: '',
      barcode: ''
    });
    
    setPendingFilters({
      minPrice: '',
      maxPrice: '',
      imei1: '',
      barcode: ''
    });
    
    // Clear any active debounce timer
    if (debounceTimerRef.current) {
      clearTimeout(debounceTimerRef.current);
      debounceTimerRef.current = null;
    }
  };

  // Apply filters to the data
  const applyFilters = useCallback((items) => {
    return items.filter(item => {
      // Apply manufacturer filter
      if (filters.manufacturer && item.manufacturer !== filters.manufacturer) {
        return false;
      }
      
      // Apply model filter
      if (filters.model && item.model !== filters.model) {
        return false;
      }
      
      // Apply RAM filter
      if (filters.ram && item.ram !== filters.ram) {
        return false;
      }
      
      // Apply storage filter
      if (filters.storage && item.storage !== filters.storage) {
        return false;
      }
      
      // Apply status filter
      if (filters.status && item.status !== filters.status) {
        return false;
      }
      
      // Apply color filter
      if (filters.color && item.color !== filters.color) {
        return false;
      }
      
      // Apply IMEI1 filter (partial match)
      if (filters.imei1 && !item.imei1.includes(filters.imei1)) {
        return false;
      }
      
      // Apply barcode filter (partial match)
      if (filters.barcode && item.barcode && !item.barcode.includes(filters.barcode)) {
        return false;
      }
      
      // Apply min price filter (using retail price)
      if (filters.minPrice) {
        const minPrice = parseFloat(parsePrice(filters.minPrice));
        if (!isNaN(minPrice) && item.retailPrice < minPrice) {
          return false;
        }
      }
      
      // Apply max price filter (using retail price)
      if (filters.maxPrice) {
        const maxPrice = parseFloat(parsePrice(filters.maxPrice));
        if (!isNaN(maxPrice) && item.retailPrice > maxPrice) {
          return false;
        }
      }
      
      // If it passed all filters, include it
      return true;
    });
  }, [filters]);

  // Load filter options from data
  const loadFilterOptions = useCallback((data) => {
    const manufacturers = [...new Set(data.map(item => item.manufacturer))].sort();
    const models = [...new Set(data.map(item => item.model))].sort();
    const rams = [...new Set(data.map(item => item.ram))].sort();
    const storages = [...new Set(data.map(item => item.storage))].sort();
    
    // For colors, filter based on manufacturer and model if selected
    let filteredData = data;
    if (filters.manufacturer) {
      filteredData = filteredData.filter(item => item.manufacturer === filters.manufacturer);
    }
    if (filters.model) {
      filteredData = filteredData.filter(item => item.model === filters.model);
    }
    
    const colors = [...new Set(filteredData.map(item => item.color))].sort();
    
    setFilterOptions({
      manufacturers,
      models,
      rams,
      storages,
      colors,
      statuses: ['On-Hand', 'On-Display', 'Sold', 'Reserved', 'Defective']
    });
  }, [filters.manufacturer, filters.model]);

  // Fetch inventory data - modified to handle search constraints
  const fetchInventoryData = useCallback(async () => {
    setLoading(true);
    setError(null);
    
    try {
      const inventoryRef = collection(db, 'inventory');
      
      // Build query constraints
      let queryConstraints = [orderBy(sortField, sortDirection)];
      
      // Add filter constraints if specified
      if (filters.manufacturer) {
        queryConstraints.push(where("manufacturer", "==", filters.manufacturer));
      }
      
      if (filters.model) {
        queryConstraints.push(where("model", "==", filters.model));
      }
      
      // Note: Firebase can only perform inequalities on a single field
      // For more complex filtering, we'll do it client-side
      
      // Create query with constraints
      const q = query(inventoryRef, ...queryConstraints);
      const snapshot = await getDocs(q);
      
      const items = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        items.push({
          id: doc.id,
          manufacturer: data.manufacturer || '',
          model: data.model || '',
          ram: data.ram || '',
          storage: data.storage || '',
          color: data.color || '',
          dealersPrice: data.dealersPrice || 0,
          retailPrice: data.retailPrice || 0,
          imei1: data.imei1 || '',
          barcode: data.barcode || '',
          status: data.status || 'On-Hand',
          dateAdded: data.dateAdded || '',
          lastUpdated: data.lastUpdated || ''
        });
      });
      
      // Store all items
      setAllItems(items);
      
      // Load filter options from the fetched data
      loadFilterOptions(items);
      
      // Apply all filters client-side
      const filteredItems = applyFilters(items);
      setInventoryItems(filteredItems);
      setInitialLoad(false);
      setLoading(false);
    } catch (error) {
      console.error("Error fetching inventory data:", error);
      setError(`Error fetching inventory: ${error.message}`);
      setLoading(false);
    }
  }, [sortField, sortDirection, filters.manufacturer, filters.model, loadFilterOptions, applyFilters]);

  // Handle the search button click
  const handleSearch = () => {
    fetchInventoryData();
  };

  // Handle sort change
  const handleSort = (field) => {
    if (field === sortField) {
      // Toggle direction if same field
      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
    } else {
      // Set new field and default to asc
      setSortField(field);
      setSortDirection('asc');
    }
  };

  // Apply filters when they change AFTER initial data load
  useEffect(() => {
    if (!initialLoad && allItems.length > 0) {
      const filtered = applyFilters(allItems);
      setInventoryItems(filtered);
    }
  }, [filters, allItems, applyFilters, initialLoad]);

  // Load manufacturer list on component mount
  useEffect(() => {
    async function loadManufacturers() {
      try {
        const inventoryRef = collection(db, 'inventory');
        const snapshot = await getDocs(inventoryRef);
        
        const manufacturers = [...new Set(
          snapshot.docs.map(doc => doc.data().manufacturer)
        )].filter(Boolean).sort();
        
        setFilterOptions(prev => ({
          ...prev,
          manufacturers
        }));
      } catch (error) {
        console.error("Error loading manufacturers:", error);
      }
    }
    
    loadManufacturers();
  }, []);

  // Show loading state
  if (loading) {
    return (
      <div className="min-h-screen bg-white p-4">
        <Card className="w-full max-w-6xl mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
          <CardHeader className="bg-[rgb(52,69,157)] py-3">
            <CardTitle className="text-2xl text-white">Inventory List</CardTitle>
          </CardHeader>
          <CardContent className="p-4">
            <p className="text-lg">Loading inventory data...</p>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Show error state
  if (error) {
    return (
      <div className="min-h-screen bg-white p-4">
        <Card className="w-full max-w-6xl mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
          <CardHeader className="bg-red-600 py-3">
            <CardTitle className="text-2xl text-white">Error</CardTitle>
          </CardHeader>
          <CardContent className="p-4">
            <p>{error}</p>
            <button 
              onClick={handleSearch}
              className="mt-4 px-4 py-2 bg-[rgb(52,69,157)] text-white rounded"
            >
              Retry
            </button>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Main component render
  return (
    <div className="min-h-screen bg-white p-4">
      <Card className="w-full max-w-6xl mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
        <CardHeader className="bg-[rgb(52,69,157)] py-3 flex flex-row justify-between items-center">
          <div className="flex items-center gap-2">
            <Smartphone className="h-6 w-6 text-white" />
            <CardTitle className="text-2xl text-white">Inventory List</CardTitle>
          </div>
          <div className="flex gap-2">
            <button
              onClick={() => setShowFilters(!showFilters)}
              className={`flex items-center gap-1 ${showFilters ? 'bg-white/20 text-white' : 'bg-white text-[rgb(52,69,157)]'} px-4 py-2 rounded text-base font-medium`}
            >
              <Filter className="h-5 w-5 mr-1" />
              <span>Filters</span>
            </button>
            <button
              onClick={handleSearch}
              className="flex items-center gap-1 bg-white text-[rgb(52,69,157)] px-4 py-2 rounded text-base font-medium"
            >
              <Search className="h-5 w-5 mr-1" />
              <span>Search</span>
            </button>
            <button
              onClick={() => fetchInventoryData()}
              className="flex items-center gap-1 bg-white text-[rgb(52,69,157)] px-4 py-2 rounded text-base font-medium"
            >
              <RefreshCw className="h-5 w-5 mr-1" />
              <span>Refresh</span>
            </button>
          </div>
        </CardHeader>

        <CardContent className="p-4">
          {/* Filters panel */}
          {showFilters && (
            <div className="mb-6 p-4 bg-gray-50 rounded-lg border">
              <div className="flex justify-between items-center mb-4">
                <h3 className="font-semibold text-lg text-[rgb(52,69,157)]">Filters</h3>
                <button 
                  onClick={clearFilters}
                  className="text-gray-500 hover:text-red-500 flex items-center"
                >
                  <X className="h-4 w-4 mr-1" />
                  Clear Filters
                </button>
              </div>
              
              <InventoryFilters 
                filters={filters}
                pendingFilters={pendingFilters}
                filterOptions={filterOptions}
                handleFilterChange={handleFilterChange}
                allItems={allItems}
              />
            </div>
          )}
          
          <div className="overflow-x-auto">
            {initialLoad ? (
              <div className="text-center py-12">
                <p className="text-lg mb-4">Use the search button to load inventory items</p>
                <p className="text-sm text-gray-500 mb-6">You can apply filters before searching or search all items</p>
                <button
                  onClick={handleSearch}
                  className="bg-[rgb(52,69,157)] text-white px-6 py-2 rounded-md flex items-center mx-auto"
                >
                  <Search className="h-5 w-5 mr-2" />
                  Search All Inventory
                </button>
              </div>
            ) : inventoryItems.length === 0 ? (
              <p className="text-center py-8 text-lg">No inventory items found matching your filters.</p>
            ) : (
              <InventoryTable 
                inventoryItems={inventoryItems} 
                handleSort={handleSort}
                sortField={sortField}
                sortDirection={sortDirection}
                formatNumberWithCommas={formatNumberWithCommas}
                allItems={allItems}
                setAllItems={setAllItems}
                setInventoryItems={setInventoryItems}
                applyFilters={applyFilters}
              />
            )}
            
            {/* Inventory count summary */}
            {!initialLoad && (
              <div className="mt-4 text-right text-gray-600">
                Showing {inventoryItems.length} items
              </div>
            )}
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default InventoryListForm;
</file>

<file path="src/components/InventorySummaryForm.jsx">
import React, { useState, useEffect } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { collection, getDocs } from 'firebase/firestore';
import { db } from '../firebase/config';
import { Smartphone, RefreshCw, ChevronDown, ChevronRight, Filter, X } from 'lucide-react';

const InventorySummaryForm = () => {
  // Original state
  const [inventoryData, setInventoryData] = useState([]);
  const [filteredData, setFilteredData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [expandedRows, setExpandedRows] = useState(new Set());
  const [expandedSections, setExpandedSections] = useState({});
  
  // Filter states
  const [showFilters, setShowFilters] = useState(false);
  const [filters, setFilters] = useState({
    manufacturer: '',
    model: '',
    ram: '',
    storage: '',
    color: ''
  });
  
  // Filter options
  const [filterOptions, setFilterOptions] = useState({
    manufacturers: [],
    models: [],
    rams: [],
    storages: [],
    colors: []
  });
  
  // Filtered options based on selections
  const [filteredOptions, setFilteredOptions] = useState({
    models: [],
    rams: [],
    storages: [],
    colors: []
  });

  // Toggle row expansion
  const toggleRowExpansion = (index) => {
    const newExpandedRows = new Set(expandedRows);
    if (newExpandedRows.has(index)) {
      newExpandedRows.delete(index);
      // When a row is collapsed, also reset its expanded sections
      setExpandedSections(prev => {
        const newState = { ...prev };
        delete newState[index];
        return newState;
      });
    } else {
      newExpandedRows.add(index);
      // Initialize section state when row is expanded
      setExpandedSections(prev => ({
        ...prev,
        [index]: { sold: false, display: false, stock: false }
      }));
    }
    setExpandedRows(newExpandedRows);
  };

  // Toggle section expansion
  const toggleSectionExpansion = (rowIndex, section) => {
    setExpandedSections(prev => ({
      ...prev,
      [rowIndex]: {
        ...prev[rowIndex],
        [section]: !prev[rowIndex]?.[section]
      }
    }));
  };

  // Handle filter change - UPDATED VERSION
  const handleFilterChange = (e) => {
    const { name, value } = e.target;
    
    // Simply update the filter value - no cascading clearing
    setFilters(prev => ({
      ...prev,
      [name]: value
    }));
  };

  // Clear all filters - UPDATED VERSION
  const clearFilters = () => {
    setFilters({
      manufacturer: '',
      model: '',
      ram: '',
      storage: '',
      color: ''
    });
    
    // Reset filtered options to show all options
    setFilteredOptions({
      models: filterOptions.models,
      rams: filterOptions.rams,
      storages: filterOptions.storages,
      colors: filterOptions.colors
    });
  };

  // Utility functions
  // Format date
  const formatDate = (dateString) => {
    if (!dateString) return 'N/A';
    
    // Try to parse the date
    try {
      const date = new Date(dateString);
      // Check if the date is valid
      if (isNaN(date.getTime())) {
        return dateString; // If invalid, just return the original string
      }
      
      // Format as MM/DD/YYYY
      return date.toLocaleDateString('en-US', {
        month: '2-digit',
        day: '2-digit',
        year: 'numeric'
      });
    } catch {
      // If any error occurs, return the original string
      return dateString;
    }
  };

  // Format price
  const formatPrice = (price) => {
    if (!price && price !== 0) return 'N/A';
    return `${price.toLocaleString()}`;
  };

  // Calculate margin percentage
  const calculateMargin = (dealersPrice, retailPrice) => {
    if (!dealersPrice || !retailPrice) return 'N/A';
    
    // Convert to numbers if they're strings
    const costPrice = typeof dealersPrice === 'string' ? parseFloat(dealersPrice.replace(/[^\d.-]/g, '')) : dealersPrice;
    const sellPrice = typeof retailPrice === 'string' ? parseFloat(retailPrice.replace(/[^\d.-]/g, '')) : retailPrice;
    
    if (costPrice <= 0) return 'N/A';
    
    const marginAmount = sellPrice - costPrice;
    const marginPercentage = (marginAmount / costPrice) * 100;
    
    return `${marginPercentage.toFixed(2)}%`;
  };

  // Format RAM and Storage with GB
  const formatWithGB = (value) => {
    if (!value) return 'N/A';
    
    // If the value already contains GB or TB, return as is
    if (value.includes('GB') || value.includes('TB') || value.includes('gb') || value.includes('tb')) {
      return value;
    }
    
    // Otherwise add GB
    return `${value}GB`;
  };

  // Apply filters to data
  const applyFilters = () => {
    if (!inventoryData.length) return;
    
    const filtered = inventoryData.filter(item => {
      // Skip filters that are not set
      if (filters.manufacturer && item.manufacturer !== filters.manufacturer) return false;
      if (filters.model && item.model !== filters.model) return false;
      if (filters.ram && item.ram !== filters.ram) return false;
      if (filters.storage && item.storage !== filters.storage) return false;
      if (filters.color && item.color !== filters.color) return false;
      return true;
    });
    
    setFilteredData(filtered);
  };
  
  // Update filtered options based on current selections - UPDATED VERSION
  const updateFilteredOptions = () => {
    if (!inventoryData.length) return;
    
    // Start with all available options
    let filteredModels = filterOptions.models;
    let filteredRams = filterOptions.rams;
    let filteredStorages = filterOptions.storages;
    let filteredColors = filterOptions.colors;
    
    // Filter models based on selected manufacturer (if any)
    if (filters.manufacturer) {
      filteredModels = [...new Set(
        inventoryData
          .filter(item => item.manufacturer === filters.manufacturer)
          .map(item => item.model)
      )].sort();
    }
    
    // Filter RAM options based on selected manufacturer and/or model (if any)
    if (filters.manufacturer || filters.model) {
      let filtered = inventoryData;
      
      if (filters.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === filters.manufacturer);
      }
      
      if (filters.model) {
        filtered = filtered.filter(item => item.model === filters.model);
      }
      
      filteredRams = [...new Set(
        filtered.map(item => item.ram)
      )].sort();
    }
    
    // Filter storage options based on selected manufacturer, model, and/or RAM (if any)
    if (filters.manufacturer || filters.model || filters.ram) {
      let filtered = inventoryData;
      
      if (filters.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === filters.manufacturer);
      }
      
      if (filters.model) {
        filtered = filtered.filter(item => item.model === filters.model);
      }
      
      if (filters.ram) {
        filtered = filtered.filter(item => item.ram === filters.ram);
      }
      
      filteredStorages = [...new Set(
        filtered.map(item => item.storage)
      )].sort();
    }
    
    // Filter color options based on all previous selections (if any)
    if (filters.manufacturer || filters.model || filters.ram || filters.storage) {
      let filtered = inventoryData;
      
      if (filters.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === filters.manufacturer);
      }
      
      if (filters.model) {
        filtered = filtered.filter(item => item.model === filters.model);
      }
      
      if (filters.ram) {
        filtered = filtered.filter(item => item.ram === filters.ram);
      }
      
      if (filters.storage) {
        filtered = filtered.filter(item => item.storage === filters.storage);
      }
      
      filteredColors = [...new Set(
        filtered.map(item => item.color)
      )].sort();
    }
    
    // Update filtered options
    setFilteredOptions({
      models: filteredModels,
      rams: filteredRams,
      storages: filteredStorages,
      colors: filteredColors
    });
  };
  // Fetch and process inventory data
  const fetchInventoryData = async () => {
    setLoading(true);
    setError(null);
    
    try {
      const inventoryRef = collection(db, 'inventory');
      const snapshot = await getDocs(inventoryRef);
      
      // Group inventory by model, ram, storage, and color
      const groupedData = {};
      
      // For filter options
      const manufacturers = new Set();
      const models = new Set();
      const rams = new Set();
      const storages = new Set();
      const colors = new Set();
      
      snapshot.forEach(doc => {
        const item = { id: doc.id, ...doc.data() };
        
        // Create a unique key for each configuration
        const key = `${item.manufacturer}_${item.model}_${item.ram}_${item.storage}_${item.color}`;
        
        // Add to filter options
        if (item.manufacturer) manufacturers.add(item.manufacturer);
        if (item.model) models.add(item.model);
        if (item.ram) rams.add(item.ram);
        if (item.storage) storages.add(item.storage);
        if (item.color) colors.add(item.color);
        
        if (!groupedData[key]) {
          groupedData[key] = {
            manufacturer: item.manufacturer,
            model: item.model,
            ram: item.ram,
            storage: item.storage,
            color: item.color,
            sold: 0,
            onDisplay: 0,
            onHand: 0,
            available: 0,
            dealersPrice: item.dealersPrice || 0,
            retailPrice: item.retailPrice || 0,
            soldItems: [],
            onDisplayItems: [],
            onHandItems: []
          };
        }
        
        // Count and store items based on status
        switch (item.status) {
          case 'Sold':
            groupedData[key].sold++;
            groupedData[key].soldItems.push(item);
            break;
          case 'On-Display':
            groupedData[key].onDisplay++;
            groupedData[key].onDisplayItems.push(item);
            break;
          case 'On-Hand':
            groupedData[key].onHand++;
            groupedData[key].onHandItems.push(item);
            break;
        }
        
        // Calculate available (On-Display + On-Hand)
        groupedData[key].available = groupedData[key].onDisplay + groupedData[key].onHand;
      });
      
      // Sort items in each group by lastUpdated
      Object.values(groupedData).forEach(group => {
        // Sort function for date strings (earliest first)
        const sortByLastUpdated = (a, b) => {
          const dateA = a.lastUpdated ? new Date(a.lastUpdated) : new Date(0);
          const dateB = b.lastUpdated ? new Date(b.lastUpdated) : new Date(0);
          return dateA - dateB; // Ascending order (oldest first)
        };
        
        // Sort all item arrays
        group.soldItems.sort(sortByLastUpdated);
        group.onDisplayItems.sort(sortByLastUpdated);
        group.onHandItems.sort(sortByLastUpdated);
      });
      
      // Convert to array and sort
      const inventoryArray = Object.values(groupedData).sort((a, b) => {
        // Sort by manufacturer, then model, then RAM, then storage, then color
        if (a.manufacturer !== b.manufacturer) {
          return a.manufacturer.localeCompare(b.manufacturer);
        }
        if (a.model !== b.model) {
          return a.model.localeCompare(b.model);
        }
        if (a.ram !== b.ram) {
          return a.ram.localeCompare(b.ram);
        }
        if (a.storage !== b.storage) {
          return a.storage.localeCompare(b.storage);
        }
        return a.color.localeCompare(b.color);
      });
      
      // Update filter options
      const filterOpts = {
        manufacturers: [...manufacturers].sort(),
        models: [...models].sort(),
        rams: [...rams].sort(),
        storages: [...storages].sort(),
        colors: [...colors].sort()
      };
      setFilterOptions(filterOpts);
      
      // Initialize filtered options with all options
      setFilteredOptions({
        models: filterOpts.models,
        rams: filterOpts.rams,
        storages: filterOpts.storages,
        colors: filterOpts.colors
      });
      
      setInventoryData(inventoryArray);
      setFilteredData(inventoryArray);
      setLoading(false);
    } catch (err) {
      console.error("Error fetching inventory data:", err);
      setError(`Error fetching inventory: ${err.message}`);
      setLoading(false);
    }
  };

  // Initial data fetch
  useEffect(() => {
    fetchInventoryData();
  }, []);
  
  // Update filtered options when inventory data changes
  useEffect(() => {
    updateFilteredOptions();
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [inventoryData, filters]);
  
  // Apply filters when they change
  useEffect(() => {
    applyFilters();
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [filters, inventoryData]);

  // Loading state
  if (loading) {
    return (
      <div className="min-h-screen bg-white p-4">
        <Card className="w-full max-w-[1400px] mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
          <CardHeader className="bg-[rgb(52,69,157)] py-3">
            <CardTitle className="text-2xl text-white">Inventory Summary</CardTitle>
          </CardHeader>
          <CardContent className="p-4">
            <div className="text-center py-12">
              <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[rgb(52,69,157)]"></div>
              <p className="mt-2 text-gray-600">Loading inventory data...</p>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  // Error state
  if (error) {
    return (
      <div className="min-h-screen bg-white p-4">
        <Card className="w-full max-w-[1400px] mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
          <CardHeader className="bg-red-600 py-3">
            <CardTitle className="text-2xl text-white">Error</CardTitle>
          </CardHeader>
          <CardContent className="p-4">
            <p className="text-red-600">{error}</p>
            <button 
              onClick={fetchInventoryData}
              className="mt-4 px-4 py-2 bg-[rgb(52,69,157)] text-white rounded"
            >
              Try Again
            </button>
          </CardContent>
        </Card>
      </div>
    );
  }
  return (
    <div className="min-h-screen bg-white p-4">
      <Card className="w-full max-w-[1400px] mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
        <CardHeader className="bg-[rgb(52,69,157)] py-3 flex flex-row justify-between items-center">
          <div className="flex items-center gap-2">
            <Smartphone className="h-6 w-6 text-white" />
            <CardTitle className="text-2xl text-white">Inventory Summary</CardTitle>
          </div>
          <div className="flex gap-2">
            <button
              onClick={() => setShowFilters(!showFilters)}
              className={`flex items-center gap-1 ${showFilters ? 'bg-white/20 text-white' : 'bg-white text-[rgb(52,69,157)]'} px-4 py-2 rounded text-base font-medium`}
            >
              <Filter className="h-5 w-5 mr-1" />
              <span>Filters</span>
            </button>
            <button
              onClick={fetchInventoryData}
              className="flex items-center gap-1 bg-white text-[rgb(52,69,157)] px-4 py-2 rounded text-base font-medium"
            >
              <RefreshCw className="h-5 w-5 mr-1" />
              <span>Refresh</span>
            </button>
          </div>
        </CardHeader>

        {/* Filter Panel */}
        {showFilters && (
          <div className="bg-gray-50 px-4 py-4 border-b">
            <div className="flex justify-between items-center mb-4">
              <h3 className="font-semibold text-lg text-[rgb(52,69,157)]">Filters</h3>
              <button 
                onClick={clearFilters}
                className="text-gray-500 hover:text-red-500 flex items-center"
              >
                <X className="h-4 w-4 mr-1" />
                Clear Filters
              </button>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-5 gap-4">
              {/* Manufacturer filter */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Manufacturer
                </label>
                <select
                  name="manufacturer"
                  value={filters.manufacturer}
                  onChange={handleFilterChange}
                  className="w-full p-2 border rounded"
                >
                  <option value="">All Manufacturers</option>
                  {filterOptions.manufacturers.map(manufacturer => (
                    <option key={manufacturer} value={manufacturer}>
                      {manufacturer}
                    </option>
                  ))}
                </select>
              </div>
              
              {/* Model filter */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Model
                </label>
                <select
                  name="model"
                  value={filters.model}
                  onChange={handleFilterChange}
                  className="w-full p-2 border rounded"
                >
                  <option value="">All Models</option>
                  {filteredOptions.models.map(model => (
                    <option key={model} value={model}>
                      {model}
                    </option>
                  ))}
                </select>
                {filters.manufacturer && (
                  <p className="text-xs text-gray-500 mt-1">
                    Showing models for {filters.manufacturer}
                  </p>
                )}
              </div>
              
              {/* RAM filter */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  RAM
                </label>
                <select
                  name="ram"
                  value={filters.ram}
                  onChange={handleFilterChange}
                  className="w-full p-2 border rounded"
                >
                  <option value="">All RAM</option>
                  {filteredOptions.rams.map(ram => (
                    <option key={ram} value={ram}>
                      {ram}
                    </option>
                  ))}
                </select>
                {(filters.manufacturer || filters.model) && (
                  <p className="text-xs text-gray-500 mt-1">
                    Filtered by current selections
                  </p>
                )}
              </div>
              
              {/* Storage filter */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Storage
                </label>
                <select
                  name="storage"
                  value={filters.storage}
                  onChange={handleFilterChange}
                  className="w-full p-2 border rounded"
                >
                  <option value="">All Storage</option>
                  {filteredOptions.storages.map(storage => (
                    <option key={storage} value={storage}>
                      {storage}
                    </option>
                  ))}
                </select>
                {(filters.manufacturer || filters.model || filters.ram) && (
                  <p className="text-xs text-gray-500 mt-1">
                    Filtered by current selections
                  </p>
                )}
              </div>
              
              {/* Color filter */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Color
                </label>
                <select
                  name="color"
                  value={filters.color}
                  onChange={handleFilterChange}
                  className="w-full p-2 border rounded"
                >
                  <option value="">All Colors</option>
                  {filteredOptions.colors.map(color => (
                    <option key={color} value={color}>
                      {color}
                    </option>
                  ))}
                </select>
                {(filters.manufacturer || filters.model || filters.ram || filters.storage) && (
                  <p className="text-xs text-gray-500 mt-1">
                    Filtered by current selections
                  </p>
                )}
              </div>
            </div>
            
            {/* Active filters summary */}
            {Object.values(filters).some(filter => filter !== '') && (
              <div className="mt-4 flex flex-wrap gap-2">
                {Object.entries(filters).map(([key, value]) => 
                  value && (
                    <div key={key} className="bg-gray-200 rounded-full px-3 py-1 text-sm flex items-center">
                      <span className="font-medium capitalize">{key}:</span>
                      <span className="ml-1">{value}</span>
                      <button 
                        onClick={() => setFilters(prev => ({ ...prev, [key]: '' }))}
                        className="ml-2 text-gray-500 hover:text-gray-700"
                      >
                        <X className="h-3 w-3" />
                      </button>
                    </div>
                  )
                )}
              </div>
            )}
          </div>
        )}

        <CardContent className="p-4">
          {filteredData.length === 0 ? (
            <div className="text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300">
              <Smartphone className="h-12 w-12 text-gray-400 mx-auto mb-4" />
              <h3 className="text-lg font-medium text-gray-700 mb-2">No inventory data found</h3>
              {Object.values(filters).some(f => f) ? (
                <>
                  <p className="text-gray-500 mb-4">No items match your current filters.</p>
                  <button
                    onClick={clearFilters}
                    className="px-4 py-2 bg-[rgb(52,69,157)] text-white rounded-md"
                  >
                    Clear Filters
                  </button>
                </>
              ) : (
                <p className="text-gray-500">There are no inventory items in the database.</p>
              )}
            </div>
          ) : (
            <div className="space-y-4">
              {/* Inventory list */}
              <div className="bg-white border rounded-lg overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr className="text-xs font-semibold text-gray-700 uppercase tracking-wider">
                      <th className="px-3 py-3 text-left">Manufacturer</th>
                      <th className="px-3 py-3 text-left">Model</th>
                      <th className="px-3 py-3 text-left">RAM</th>
                      <th className="px-3 py-3 text-left">Storage</th>
                      <th className="px-3 py-3 text-left">Color</th>
                      <th className="pl-0 pr-1 py-3 text-right">Dealer&apos;s Price</th>
                      <th className="px-1 py-3 text-right">Retail Price</th>
                      <th className="px-1 py-3 text-right">Margin</th>
                      <th className="pl-12 pr-1 py-3 text-center">Sold</th>
                      <th className="px-1 py-3 text-center">Display</th>
                      <th className="px-1 py-3 text-center">Stock</th>
                      <th className="px-1 py-3 text-center">Available</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    {filteredData.map((item, index) => (
                      <React.Fragment key={index}>
                        {/* Main row */}
                        <tr 
                          className={`hover:bg-gray-100 cursor-pointer ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}
                          onClick={() => toggleRowExpansion(index)}
                        >
                          <td className="px-3 py-3 text-sm">{item.manufacturer}</td>
                          <td className="px-3 py-3 text-sm font-medium">{item.model}</td>
                          <td className="px-3 py-3 text-sm">{formatWithGB(item.ram)}</td>
                          <td className="px-3 py-3 text-sm">{formatWithGB(item.storage)}</td>
                          <td className="px-3 py-3 text-sm">{item.color}</td>
                          <td className="pl-0 pr-1 py-3 text-sm text-right">{formatPrice(item.dealersPrice)}</td>
                          <td className="px-1 py-3 text-sm text-right">{formatPrice(item.retailPrice)}</td>
                          <td className="px-1 py-3 text-sm text-right font-medium">
                            {calculateMargin(item.dealersPrice, item.retailPrice)}
                          </td>
                          
                          <td className="pl-12 pr-1 py-2 text-sm text-center">
                            <span className="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">
                              {item.sold}
                            </span>
                          </td>
                          
                          <td className="px-1 py-2 text-sm text-center">
                            <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">
                              {item.onDisplay}
                            </span>
                          </td>
                          
                          <td className="px-1 py-2 text-sm text-center">
                            <span className="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">
                              {item.onHand}
                            </span>
                          </td>
                          
                          <td className="px-1 py-2 text-sm text-center">
                            <span className="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">
                              {item.available}
                            </span>
                          </td>
                        </tr>
                        {/* Expanded details */}
                        {expandedRows.has(index) && (
                          <tr>
                            <td colSpan="12" className="px-0 py-0 border-b border-gray-200">
                              <div className="px-4 pb-4 pt-2 bg-gray-100">
                                <div className="space-y-4">
                                  
                                  {/* Sold Items */}
                                  {item.soldItems.length > 0 && (
                                    <div>
                                      <div 
                                        className="flex items-center justify-between cursor-pointer bg-purple-50 p-2 rounded-t border border-purple-200"
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          toggleSectionExpansion(index, 'sold');
                                        }}
                                      >
                                        <h4 className="font-semibold text-purple-700">
                                          Sold Units ({item.sold})
                                        </h4>
                                        {expandedSections[index]?.sold ? (
                                          <ChevronDown className="h-5 w-5 text-purple-500" />
                                        ) : (
                                          <ChevronRight className="h-5 w-5 text-purple-500" />
                                        )}
                                      </div>
                                      
                                      {expandedSections[index]?.sold && (
                                        <div className="overflow-x-auto border border-t-0 border-purple-200 rounded-b">
                                          <table className="min-w-full">
                                            <thead className="bg-purple-50">
                                              <tr className="text-xs text-purple-800">
                                                <th className="py-2 px-3 text-left border-b">IMEI1</th>
                                                <th className="py-2 px-3 text-left border-b">IMEI2</th>
                                                <th className="py-2 px-3 text-left border-b">Barcode</th>
                                                <th className="py-2 px-3 text-right border-b">Retail Price</th>
                                                <th className="py-2 px-3 text-left border-b">Last Updated</th>
                                              </tr>
                                            </thead>
                                            <tbody className="bg-white">
                                              {item.soldItems.map((soldItem, soldIndex) => (
                                                <tr key={soldIndex} className={soldIndex % 2 === 0 ? 'bg-white' : 'bg-purple-50'}>
                                                  <td className="py-2 px-3 text-xs">{soldItem.imei1 || 'N/A'}</td>
                                                  <td className="py-2 px-3 text-xs">{soldItem.imei2 || '-'}</td>
                                                  <td className="py-2 px-3 text-xs">{soldItem.barcode || 'N/A'}</td>
                                                  <td className="py-2 px-3 text-xs text-right">{formatPrice(soldItem.retailPrice)}</td>
                                                  <td className="py-2 px-3 text-xs">{formatDate(soldItem.lastUpdated)}</td>
                                                </tr>
                                              ))}
                                            </tbody>
                                          </table>
                                        </div>
                                      )}
                                    </div>
                                  )}
                                  {/* On Display Items */}
                                  {item.onDisplayItems.length > 0 && (
                                    <div>
                                      <div 
                                        className="flex items-center justify-between cursor-pointer bg-yellow-50 p-2 rounded-t border border-yellow-200"
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          toggleSectionExpansion(index, 'display');
                                        }}
                                      >
                                        <h4 className="font-semibold text-yellow-700">
                                          Display Units ({item.onDisplay})
                                        </h4>
                                        {expandedSections[index]?.display ? (
                                          <ChevronDown className="h-5 w-5 text-yellow-500" />
                                        ) : (
                                          <ChevronRight className="h-5 w-5 text-yellow-500" />
                                        )}
                                      </div>
                                      
                                      {expandedSections[index]?.display && (
                                        <div className="overflow-x-auto border border-t-0 border-yellow-200 rounded-b">
                                          <table className="min-w-full">
                                            <thead className="bg-yellow-50">
                                              <tr className="text-xs text-yellow-800">
                                                <th className="py-2 px-3 text-left border-b">IMEI1</th>
                                                <th className="py-2 px-3 text-left border-b">IMEI2</th>
                                                <th className="py-2 px-3 text-left border-b">Barcode</th>
                                                <th className="py-2 px-3 text-right border-b">Retail Price</th>
                                                <th className="py-2 px-3 text-left border-b">Last Updated</th>
                                              </tr>
                                            </thead>
                                            <tbody className="bg-white">
                                              {item.onDisplayItems.map((displayItem, displayIndex) => (
                                                <tr key={displayIndex} className={displayIndex % 2 === 0 ? 'bg-white' : 'bg-yellow-50'}>
                                                  <td className="py-2 px-3 text-xs">{displayItem.imei1 || 'N/A'}</td>
                                                  <td className="py-2 px-3 text-xs">{displayItem.imei2 || '-'}</td>
                                                  <td className="py-2 px-3 text-xs">{displayItem.barcode || 'N/A'}</td>
                                                  <td className="py-2 px-3 text-xs text-right">{formatPrice(displayItem.retailPrice)}</td>
                                                  <td className="py-2 px-3 text-xs">{formatDate(displayItem.lastUpdated)}</td>
                                                </tr>
                                              ))}
                                            </tbody>
                                          </table>
                                        </div>
                                      )}
                                    </div>
                                  )}
                                  {/* On Hand Items */}
                                  {item.onHandItems.length > 0 && (
                                    <div>
                                      <div 
                                        className="flex items-center justify-between cursor-pointer bg-blue-50 p-2 rounded-t border border-blue-200"
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          toggleSectionExpansion(index, 'stock');
                                        }}
                                      >
                                        <h4 className="font-semibold text-blue-700">
                                          Stock Units ({item.onHand})
                                        </h4>
                                        {expandedSections[index]?.stock ? (
                                          <ChevronDown className="h-5 w-5 text-blue-500" />
                                        ) : (
                                          <ChevronRight className="h-5 w-5 text-blue-500" />
                                        )}
                                      </div>
                                      
                                      {expandedSections[index]?.stock && (
                                        <div className="overflow-x-auto border border-t-0 border-blue-200 rounded-b">
                                          <table className="min-w-full">
                                            <thead className="bg-blue-50">
                                              <tr className="text-xs text-blue-800">
                                                <th className="py-2 px-3 text-left border-b">IMEI1</th>
                                                <th className="py-2 px-3 text-left border-b">IMEI2</th>
                                                <th className="py-2 px-3 text-left border-b">Barcode</th>
                                                <th className="py-2 px-3 text-right border-b">Retail Price</th>
                                                <th className="py-2 px-3 text-left border-b">Last Updated</th>
                                              </tr>
                                            </thead>
                                            <tbody className="bg-white">
                                              {item.onHandItems.map((handItem, handIndex) => (
                                                <tr key={handIndex} className={handIndex % 2 === 0 ? 'bg-white' : 'bg-blue-50'}>
                                                  <td className="py-2 px-3 text-xs">{handItem.imei1 || 'N/A'}</td>
                                                  <td className="py-2 px-3 text-xs">{handItem.imei2 || '-'}</td>
                                                  <td className="py-2 px-3 text-xs">{handItem.barcode || 'N/A'}</td>
                                                  <td className="py-2 px-3 text-xs text-right">{formatPrice(handItem.retailPrice)}</td>
                                                  <td className="py-2 px-3 text-xs">{formatDate(handItem.lastUpdated)}</td>
                                                </tr>
                                              ))}
                                            </tbody>
                                          </table>
                                        </div>
                                      )}
                                    </div>
                                  )}

                                  {/* Empty states */}
                                  {item.soldItems.length === 0 && item.onDisplayItems.length === 0 && item.onHandItems.length === 0 && (
                                    <div className="text-center py-4 text-gray-500">
                                      No detailed information available for this configuration
                                    </div>
                                  )}
                                </div>
                              </div>
                            </td>
                          </tr>
                        )}
                      </React.Fragment>
                    ))}
                    </tbody>
                </table>
              </div>

              {/* Summary footer */}
              <div className="text-center text-gray-600">
                {Object.values(filters).some(f => f) 
                  ? `Showing ${filteredData.length} of ${inventoryData.length} inventory configurations (filtered)`
                  : `Showing ${filteredData.length} inventory configurations`}
                {expandedRows.size > 0 && `  ${expandedRows.size} rows expanded`}
              </div>
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
};

export default InventorySummaryForm;
</file>

<file path="src/components/phone-list/PhoneAdvancedSearch.jsx">
import { useState } from 'react';
import PropTypes from 'prop-types';
import { X } from 'lucide-react';

const PhoneAdvancedSearch = ({ isOpen, onClose, onSearch, manufacturers }) => {
  const [searchCriteria, setSearchCriteria] = useState({
    manufacturer: '',
    model: '',
    ram: '',
    storage: '',
    display: '',
    battery: { min: '', max: '' },
    chipset: ''
  });

  if (!isOpen) return null;

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    
    if (name.includes('.')) {
      // Handle nested fields like battery.min
      const [parent, child] = name.split('.');
      setSearchCriteria(prev => ({
        ...prev,
        [parent]: {
          ...prev[parent],
          [child]: value
        }
      }));
    } else {
      setSearchCriteria(prev => ({
        ...prev,
        [name]: value
      }));
    }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    onSearch(searchCriteria);
    onClose();
  };

  const handleReset = () => {
    setSearchCriteria({
      manufacturer: '',
      model: '',
      ram: '',
      storage: '',
      display: '',
      battery: { min: '', max: '' },
      chipset: ''
    });
  };

  return (
    <div className="fixed inset-0 bg-black/30 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-lg shadow-lg max-w-xl w-full">
        <div className="p-4 border-b flex justify-between items-center">
          <h2 className="text-lg font-semibold text-[rgb(52,69,157)]">Advanced Search</h2>
          <button 
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700"
          >
            <X className="h-5 w-5" />
          </button>
        </div>
        
        <form onSubmit={handleSubmit}>
          <div className="p-4 space-y-4">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Manufacturer
                </label>
                <select
                  name="manufacturer"
                  value={searchCriteria.manufacturer}
                  onChange={handleInputChange}
                  className="w-full p-2 border rounded"
                >
                  <option value="">Any Manufacturer</option>
                  {manufacturers.map(manufacturer => (
                    <option key={manufacturer} value={manufacturer}>
                      {manufacturer}
                    </option>
                  ))}
                </select>
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Model
                </label>
                <input
                  type="text"
                  name="model"
                  value={searchCriteria.model}
                  onChange={handleInputChange}
                  placeholder="e.g. Galaxy S25"
                  className="w-full p-2 border rounded"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  RAM
                </label>
                <input
                  type="text"
                  name="ram"
                  value={searchCriteria.ram}
                  onChange={handleInputChange}
                  placeholder="e.g. 8GB"
                  className="w-full p-2 border rounded"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Storage
                </label>
                <input
                  type="text"
                  name="storage"
                  value={searchCriteria.storage}
                  onChange={handleInputChange}
                  placeholder="e.g. 256GB"
                  className="w-full p-2 border rounded"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Display Type
                </label>
                <input
                  type="text"
                  name="display"
                  value={searchCriteria.display}
                  onChange={handleInputChange}
                  placeholder="e.g. AMOLED"
                  className="w-full p-2 border rounded"
                />
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Chipset
                </label>
                <input
                  type="text"
                  name="chipset"
                  value={searchCriteria.chipset}
                  onChange={handleInputChange}
                  placeholder="e.g. Snapdragon"
                  className="w-full p-2 border rounded"
                />
              </div>
              
              <div className="md:col-span-2">
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Battery Capacity (mAh)
                </label>
                <div className="flex gap-4">
                  <div className="flex-1">
                    <input
                      type="number"
                      name="battery.min"
                      value={searchCriteria.battery.min}
                      onChange={handleInputChange}
                      placeholder="Min"
                      className="w-full p-2 border rounded"
                    />
                  </div>
                  <div className="flex-1">
                    <input
                      type="number"
                      name="battery.max"
                      value={searchCriteria.battery.max}
                      onChange={handleInputChange}
                      placeholder="Max"
                      className="w-full p-2 border rounded"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div className="p-4 bg-gray-50 flex justify-end gap-2">
            <button
              type="button"
              onClick={handleReset}
              className="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-100"
            >
              Reset
            </button>
            <button
              type="button"
              onClick={onClose}
              className="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-100"
            >
              Cancel
            </button>
            <button
              type="submit"
              className="px-4 py-2 bg-[rgb(52,69,157)] text-white rounded hover:bg-[rgb(52,69,157)]/90"
            >
              Search
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

PhoneAdvancedSearch.propTypes = {
  isOpen: PropTypes.bool.isRequired,
  onClose: PropTypes.func.isRequired,
  onSearch: PropTypes.func.isRequired,
  manufacturers: PropTypes.array.isRequired
};

export default PhoneAdvancedSearch;
</file>

<file path="src/components/phone-list/PhoneDetailModal.jsx">
import PropTypes from 'prop-types';
import { X, Monitor, Cpu, Camera, Battery, Palette } from 'lucide-react';

const PhoneDetailModal = ({ isOpen, phone, onClose }) => {
  if (!isOpen || !phone) return null;

  const SpecRow = ({ label, value }) => (
    <div className="flex items-center py-0.5">
      <p className="text-[rgb(52,69,157)] w-36 text-sm">{label}:</p>
      <p className="text-sm">{value}</p>
    </div>
  );
  
  SpecRow.propTypes = {
    label: PropTypes.string.isRequired,
    value: PropTypes.oneOfType([PropTypes.string, PropTypes.number])
  };

  const formatArray = (arr) => {
    if (!arr || !Array.isArray(arr)) return '-';
    return arr.join(', ');
  };

  return (
    <div className="fixed inset-0 bg-black/30 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
          <h2 className="text-xl font-bold text-[rgb(52,69,157)]">
            {phone.manufacturer} {phone.model}
          </h2>
          <button 
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700"
          >
            <X className="h-5 w-5" />
          </button>
        </div>
        
        <div className="p-6 space-y-6">
          {/* Display Section */}
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <Monitor className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Display</h3>
            </div>
            <div className="ml-7">
              <SpecRow label="Type" value={phone.display || '-'} />
              <SpecRow label="Resolution" value={phone.resolution || '-'} />
              {phone.resolution_extra && (
                <SpecRow label="Refresh Rate" value={`${phone.resolution_extra} Hz`} />
              )}
              {phone.resolution_extra2 && (
                <SpecRow label="Pixel Density" value={`${phone.resolution_extra2} ppi`} />
              )}
              <SpecRow label="Protection" value={phone.protection || '-'} />
            </div>
          </div>

          {/* Performance Section */}
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <Cpu className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Performance</h3>
            </div>
            <div className="ml-7">
              <SpecRow label="OS" value={phone.os || '-'} />
              <SpecRow label="Chipset" value={phone.chipset || '-'} />
              {phone.chipset_extra && (
                <SpecRow label="Benchmark" value={phone.chipset_extra} />
              )}
              <SpecRow label="CPU" value={phone.cpu || '-'} />
              <SpecRow label="GPU" value={phone.gpu || '-'} />
              <SpecRow label="RAM" value={formatArray(phone.storage_extra)} />
              <SpecRow label="Storage" value={formatArray(phone.storage)} />
            </div>
          </div>

          {/* Camera Section */}
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <Camera className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Camera</h3>
            </div>
            <div className="ml-7">
              <SpecRow label="Rear Camera" value={phone.rearCamera || '-'} />
              <SpecRow label="Front Camera" value={phone.frontCamera || '-'} />
            </div>
          </div>

          {/* Battery Section */}
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <Battery className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Battery</h3>
            </div>
            <div className="ml-7">
              <SpecRow label="Capacity" value={phone.battery ? `${phone.battery} mAh` : '-'} />
              <SpecRow label="Wired Charging" value={phone.wiredCharging ? `${phone.wiredCharging}W` : '-'} />
              <SpecRow label="Wireless Charging" value={phone.wirelessCharging ? `${phone.wirelessCharging}W` : '-'} />
            </div>
          </div>

          {/* Misc Section */}
          <div className="space-y-2">
            <div className="flex items-center gap-2">
              <Palette className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Additional Info</h3>
            </div>
            <div className="ml-7">
              <SpecRow label="Released" value={phone.released || '-'} />
              <SpecRow label="Weight" value={phone.weight ? `${phone.weight}g` : '-'} />
              
              {/* Colors Section */}
              <div className="flex py-0.5">
                <p className="text-[rgb(52,69,157)] w-36 text-sm">Colors:</p>
                <div className="flex flex-wrap gap-2">
                  {Array.isArray(phone.colors) && phone.colors.length > 0 ? (
                    phone.colors.map((color, index) => (
                      <span 
                        key={index} 
                        className="inline-block px-2 py-1 text-xs bg-gray-100 rounded-full"
                      >
                        {color}
                      </span>
                    ))
                  ) : (
                    <p className="text-sm">-</p>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

PhoneDetailModal.propTypes = {
  isOpen: PropTypes.bool.isRequired,
  phone: PropTypes.object,
  onClose: PropTypes.func.isRequired
};

export default PhoneDetailModal;
</file>

<file path="src/components/phone-selection/hooks/usePhoneCache.js">
import { useState, useCallback } from 'react';
import { collection, getDocs, doc, setDoc } from 'firebase/firestore';
import { db } from '../../../firebase/config';
import { formatNumberWithCommas, getCurrentDate } from '../utils/phoneUtils';

export const usePhoneCache = () => {
  const [priceCache, setPriceCache] = useState({});
  
  // Load price cache from existing inventory
  const loadPriceCacheFromInventory = useCallback(async () => {
    try {
      const newPriceCache = {};
     
      // First load price configurations (both base and color-specific)
      const configsRef = collection(db, 'price_configurations');
      const configsSnapshot = await getDocs(configsRef);
     
      configsSnapshot.forEach(doc => {
        const data = doc.data();
        if (data.manufacturer && data.model && data.ram && data.storage) {
          let cacheKey;
         
          if (data.color) {
            // Color-specific price
            cacheKey = `${data.manufacturer}_${data.model}_${data.ram}_${data.storage}_${data.color}`;
          } else {
            // Base price
            cacheKey = `${data.manufacturer}_${data.model}_${data.ram}_${data.storage}`;
          }
         
          newPriceCache[cacheKey] = {
            dealersPrice: formatNumberWithCommas(data.dealersPrice.toString()),
            retailPrice: formatNumberWithCommas(data.retailPrice.toString()),
            lastUpdated: data.lastUpdated
          };
        }
      });
     
      // Then load barcodes from inventory
      const inventoryRef = collection(db, 'inventory');
      const inventorySnapshot = await getDocs(inventoryRef);
     
      inventorySnapshot.forEach(doc => {
        const data = doc.data();
        if (data.manufacturer && data.model && data.ram && data.storage && data.color && data.barcode) {
          const barcodeKey = `${data.manufacturer}_${data.model}_${data.ram}_${data.storage}_${data.color}`;
         
          // Update existing entry or create new one
          newPriceCache[barcodeKey] = {
            ...newPriceCache[barcodeKey] || {},
            barcode: data.barcode,
            // Only update lastUpdated if this is a new entry
            lastUpdated: newPriceCache[barcodeKey]?.lastUpdated || data.lastUpdated
          };
        }
      });
     
      console.log("Price cache loaded:", Object.keys(newPriceCache).length, "entries");
      setPriceCache(newPriceCache);
    } catch (error) {
      console.error("Error loading price cache:", error);
    }
  }, [setPriceCache]);
  
  // Helper function to save/update price configurations
  const updatePriceConfiguration = async (manufacturer, model, ram, storage, dealersPrice, retailPrice, color = null) => {
    try {
      // Create a unique ID - with or without color
      let configId;
      if (color) {
        // Color-specific pricing
        configId = `${manufacturer}_${model}_${ram}_${storage}_${color}`.replace(/\s+/g, '_').toLowerCase();
      } else {
        // Base pricing for this configuration
        configId = `${manufacturer}_${model}_${ram}_${storage}`.replace(/\s+/g, '_').toLowerCase();
      }
      
      // Remove commas and convert to number
      const dPrice = parseFloat(dealersPrice.toString().replace(/,/g, '')) || 0;
      const rPrice = parseFloat(retailPrice.toString().replace(/,/g, '')) || 0;
      
      await setDoc(doc(db, 'price_configurations', configId), {
        manufacturer,
        model,
        ram,
        storage,
        color, // null for base configuration
        dealersPrice: dPrice,
        retailPrice: rPrice,
        lastUpdated: getCurrentDate()
      }, { merge: true });
      
      return true;
    } catch (error) {
      console.error("Error updating price configuration:", error);
      return false;
    }
  };

  return {
    priceCache,
    setPriceCache,
    loadPriceCacheFromInventory,
    updatePriceConfiguration
  };
};

export default usePhoneCache;
</file>

<file path="src/components/phone-selection/hooks/usePhoneOptions.js">
import { useState } from 'react';
import { collection, getDocs, query, where } from 'firebase/firestore';
import { db } from '../../../firebase/config';

export const usePhoneOptions = () => {
  // State for available options
  const [manufacturers, setManufacturers] = useState([]);
  const [models, setModels] = useState([]);
  const [colors, setColors] = useState([]);
  const [storage, setStorage] = useState([]);
  const [ram, setRam] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  // Fetch manufacturers
  const fetchManufacturers = async () => {
    setLoading(true);
    try {
      console.log("Attempting to fetch manufacturers...");
      const phonesRef = collection(db, 'phones');
      const snapshot = await getDocs(phonesRef);
      
      // Extract unique manufacturers
      const uniqueManufacturers = new Set();
      snapshot.forEach(doc => {
        const data = doc.data();
        if (data.manufacturer) {
          uniqueManufacturers.add(data.manufacturer);
        }
      });
      
      const manufacturerArray = Array.from(uniqueManufacturers).sort();
      console.log("Manufacturers fetched:", manufacturerArray);
      setManufacturers(manufacturerArray);
      setLoading(false);
      return manufacturerArray;
    } catch (error) {
      console.error("Error fetching manufacturers:", error);
      setError(`Error fetching manufacturers: ${error.message}`);
      setLoading(false);
      return [];
    }
  };

  // Fetch models for a specific manufacturer
  const fetchModels = async (manufacturer) => {
    if (!manufacturer) {
      setModels([]);
      return [];
    }
    
    setLoading(true);
    try {
      console.log(`Fetching models for ${manufacturer}...`);
      const phonesRef = collection(db, 'phones');
      const q = query(phonesRef, where("manufacturer", "==", manufacturer));
      const snapshot = await getDocs(q);
      
      // Extract unique models
      const uniqueModels = new Set();
      snapshot.forEach(doc => {
        const data = doc.data();
        if (data.model) {
          uniqueModels.add(data.model);
        }
      });
      
      const modelArray = Array.from(uniqueModels).sort();
      console.log("Models fetched:", modelArray);
      setModels(modelArray);
      setLoading(false);
      return modelArray;
    } catch (error) {
      console.error(`Error fetching models for ${manufacturer}:`, error);
      setError(`Error fetching models: ${error.message}`);
      setLoading(false);
      return [];
    }
  };

  // Fetch options (colors, storage, RAM) for a specific model
  const fetchOptions = async (manufacturer, model) => {
    if (!manufacturer || !model) {
      setColors([]);
      setStorage([]);
      setRam([]);
      return { colors: [], storage: [], ram: [] };
    }
    
    setLoading(true);
    try {
      console.log(`Fetching options for ${manufacturer} ${model}...`);
      const phonesRef = collection(db, 'phones');
      const q = query(
        phonesRef, 
        where("manufacturer", "==", manufacturer),
        where("model", "==", model)
      );
      const snapshot = await getDocs(q);
      
      let colorsArray = [];
      let storageArray = [];
      let ramArray = [];
      
      // Get the first matching document
      if (!snapshot.empty) {
        const data = snapshot.docs[0].data();
        
        // Set colors, storage and RAM options
        colorsArray = Array.isArray(data.colors) ? data.colors : [];
        storageArray = Array.isArray(data.storage) ? data.storage : [];
        ramArray = Array.isArray(data.storage_extra) ? data.storage_extra : [];
        
        setColors(colorsArray);
        setStorage(storageArray);
        setRam(ramArray);
        
        console.log("Options fetched:", {
          colors: colorsArray,
          storage: storageArray,
          ram: ramArray
        });
      }
      
      setLoading(false);
      return { colors: colorsArray, storage: storageArray, ram: ramArray };
    } catch (error) {
      console.error(`Error fetching options for ${manufacturer} ${model}:`, error);
      setError(`Error fetching options: ${error.message}`);
      setLoading(false);
      return { colors: [], storage: [], ram: [] };
    }
  };
  
  return {
    manufacturers,
    models,
    colors,
    storage,
    ram,
    loading,
    error,
    fetchManufacturers,
    fetchModels,
    fetchOptions
  };
};

export default usePhoneOptions;
</file>

<file path="src/components/phone-selection/PhoneAdditionalInfo.jsx">
import PropTypes from 'prop-types';

const PhoneAdditionalInfo = ({
  imei1,
  imei2,
  barcode,
  status,
  lastUpdated,
  handleImei1Change,
  handleImei2Change,
  handleBarcodeChange,
  handleStatusChange,
  imei1Error,
  imei2Error,
}) => {
  return (
    <div className="pt-4 border-t border-gray-300 space-y-4">
      <h3 className="text-lg font-semibold text-[rgb(52,69,157)]">Additional Details</h3>
      
      {/* IMEI Fields */}
      <div className="flex gap-4">
        <div className="flex-1 space-y-2">
          <label className="block text-[rgb(52,69,157)] font-semibold">IMEI 1:</label>
          <input 
            type="text" 
            className={`w-full p-2 border rounded ${imei1Error ? 'border-red-500' : ''}`}
            value={imei1}
            onChange={handleImei1Change}
            placeholder="15-digit IMEI number"
            maxLength={15}
            required
          />
          {imei1Error && (
            <p className="text-red-500 text-sm mt-1">{imei1Error}</p>
          )}
        </div>
        <div className="flex-1 space-y-2">
          <label className="block text-[rgb(52,69,157)] font-semibold">IMEI 2:</label>
          <input 
            type="text" 
            className={`w-full p-2 border rounded ${imei2Error ? 'border-red-500' : ''}`}
            value={imei2}
            onChange={handleImei2Change}
            placeholder="Optional"
            maxLength={15}
          />
          {imei2Error && (
            <p className="text-red-500 text-sm mt-1">{imei2Error}</p>
          )}
        </div>
      </div>
      
      {/* Barcode */}
      <div className="space-y-2">
        <label className="block text-[rgb(52,69,157)] font-semibold">Barcode:</label>
        <input 
          type="text" 
          className="w-full p-2 border rounded"
          value={barcode}
          onChange={handleBarcodeChange}
          placeholder="Product barcode"
          required
        />
      </div>
      
      {/* Status and Last Updated Fields */}
      <div className="flex gap-4">
        <div className="flex-1 space-y-2">
          <label className="block text-[rgb(52,69,157)] font-semibold">Status:</label>
          <select
            className="w-full p-2 border rounded"
            value={status}
            onChange={handleStatusChange}
            required
          >
            <option value="On-Hand">On-Hand</option>
            <option value="On-Display">On-Display</option>
            <option value="Sold">Sold</option>
            <option value="Reserved">Reserved</option>
            <option value="Defective">Defective</option>
          </select>
        </div>
        <div className="flex-1 space-y-2">
          <label className="block text-[rgb(52,69,157)] font-semibold">Last Updated:</label>
          <input 
            type="text" 
            className="w-full p-2 border rounded bg-gray-100"
            value={lastUpdated}
            readOnly
          />
        </div>
      </div>
    </div>
  );
};

PhoneAdditionalInfo.propTypes = {
  imei1: PropTypes.string.isRequired,
  imei2: PropTypes.string.isRequired,
  barcode: PropTypes.string.isRequired,
  status: PropTypes.string.isRequired,
  lastUpdated: PropTypes.string.isRequired,
  handleImei1Change: PropTypes.func.isRequired,
  handleImei2Change: PropTypes.func.isRequired,
  handleBarcodeChange: PropTypes.func.isRequired,
  handleStatusChange: PropTypes.func.isRequired,
  imei1Error: PropTypes.string,
  imei2Error: PropTypes.string
};

export default PhoneAdditionalInfo;
</file>

<file path="src/components/phone-selection/PhoneBasicInfo.jsx">
import PropTypes from 'prop-types';

const PhoneBasicInfo = ({ 
  selectedManufacturer, 
  selectedModel,
  selectedRam,
  selectedStorage,
  manufacturers,
  models,
  ram,
  storage,
  handleRamChange,
  handleStorageChange,
  handleManufacturerChange,
  handleModelChange
}) => {
  return (
    <>
      {/* Manufacturer Selection */}
      <div className="space-y-2">
        <label className="block text-[rgb(52,69,157)] font-semibold">Manufacturer:</label>
        <select 
          className="w-full p-2 border rounded"
          value={selectedManufacturer}
          onChange={handleManufacturerChange}
          required
        >
          <option value="">-- Select Manufacturer --</option>
          {manufacturers.map(manufacturer => (
            <option key={manufacturer} value={manufacturer}>
              {manufacturer}
            </option>
          ))}
        </select>
      </div>

      {/* Model Selection */}
      <div className="space-y-2">
        <label className="block text-[rgb(52,69,157)] font-semibold">Model:</label>
        <select 
          className="w-full p-2 border rounded"
          value={selectedModel}
          onChange={handleModelChange}
          disabled={!selectedManufacturer}
          required
        >
          <option value="">-- Select Model --</option>
          {models.map(model => (
            <option key={model} value={model}>
              {model}
            </option>
          ))}
        </select>
      </div>

      {selectedModel && (
        <div className="flex gap-4">
          {/* RAM Selection */}
          <div className="flex-1 space-y-2">
            <label className="block text-[rgb(52,69,157)] font-semibold">RAM:</label>
            <select 
              className="w-full p-2 border rounded"
              value={selectedRam}
              onChange={handleRamChange}
              required={ram.length > 0}
            >
              <option value="">-- Select RAM --</option>
              {ram.map(option => (
                <option key={option} value={option}>
                  {option}
                </option>
              ))}
            </select>
          </div>

          {/* Storage Selection */}
          <div className="flex-1 space-y-2">
            <label className="block text-[rgb(52,69,157)] font-semibold">Storage:</label>
            <select 
              className="w-full p-2 border rounded"
              value={selectedStorage}
              onChange={handleStorageChange}
              required={storage.length > 0}
            >
              <option value="">-- Select Storage --</option>
              {storage.map(option => (
                <option key={option} value={option}>
                  {option}
                </option>
              ))}
            </select>
          </div>
        </div>
      )}
    </>
  );
};

PhoneBasicInfo.propTypes = {
  selectedManufacturer: PropTypes.string.isRequired,
  selectedModel: PropTypes.string.isRequired,
  selectedRam: PropTypes.string.isRequired,
  selectedStorage: PropTypes.string.isRequired,
  manufacturers: PropTypes.array.isRequired,
  models: PropTypes.array.isRequired,
  ram: PropTypes.array.isRequired,
  storage: PropTypes.array.isRequired,
  handleRamChange: PropTypes.func.isRequired,
  handleStorageChange: PropTypes.func.isRequired,
  handleManufacturerChange: PropTypes.func.isRequired,
  handleModelChange: PropTypes.func.isRequired
};

export default PhoneBasicInfo;
</file>

<file path="src/components/phone-selection/PhoneColorInfo.jsx">
import PropTypes from 'prop-types';

const PhoneColorInfo = ({
  selectedColor,
  colors,
  handleColorChange
}) => {
  return (
    <div className="space-y-2">
      <label className="block text-[rgb(52,69,157)] font-semibold">Color:</label>
      <select 
        className="w-full p-2 border rounded"
        value={selectedColor}
        onChange={handleColorChange}
        required={colors.length > 0}
      >
        <option value="">-- Select Color --</option>
        {colors.map(color => (
          <option key={color} value={color}>
            {color}
          </option>
        ))}
      </select>
    </div>
  );
};

PhoneColorInfo.propTypes = {
  selectedColor: PropTypes.string.isRequired,
  colors: PropTypes.array.isRequired,
  handleColorChange: PropTypes.func.isRequired
};

export default PhoneColorInfo;
</file>

<file path="src/components/phone-selection/PhonePriceInfo.jsx">
import PropTypes from 'prop-types';
import { calculateMarkup, calculateProfit } from './utils/phoneUtils';

const PhonePriceInfo = ({
  dealersPrice,
  retailPrice,
  handleDealersPriceChange,
  handleRetailPriceChange
}) => {
  // Helper function to get display values for profit calculation
  // This ensures we don't try to calculate with empty values
  const getPriceForCalculation = (price) => {
    if (!price || price === '') return '0';
    return price;
  };
  
  return (
    <div className="space-y-4 pt-2">
      <div className="flex gap-4">
        <div className="flex-1 space-y-2">
          <label className="block text-[rgb(52,69,157)] font-semibold">Dealers Price:</label>
          <input 
            type="text" 
            className="w-full p-2 border rounded"
            value={dealersPrice}
            onChange={handleDealersPriceChange}
            placeholder="0.00"
            required
          />
        </div>
        <div className="flex-1 space-y-2">
          <label className="block text-[rgb(52,69,157)] font-semibold">Retail Price:</label>
          <input 
            type="text" 
            className="w-full p-2 border rounded"
            value={retailPrice}
            onChange={handleRetailPriceChange}
            placeholder="0.00"
            required
          />
        </div>
      </div>
      
      {/* Markup and Profit calculations - only show if both prices have values */}
      {dealersPrice && retailPrice && dealersPrice !== '' && retailPrice !== '' && (
        <div className="flex gap-4">
          <div className="flex-1 space-y-2">
            <label className="block text-[rgb(52,69,157)] font-semibold">Markup:</label>
            <div className="w-full p-2 border rounded bg-gray-50">
              {calculateMarkup(getPriceForCalculation(dealersPrice), getPriceForCalculation(retailPrice))}%
            </div>
          </div>
          <div className="flex-1 space-y-2">
            <label className="block text-[rgb(52,69,157)] font-semibold">Profit:</label>
            <div className="w-full p-2 border rounded bg-gray-50">
              {calculateProfit(getPriceForCalculation(dealersPrice), getPriceForCalculation(retailPrice))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

PhonePriceInfo.propTypes = {
  dealersPrice: PropTypes.string.isRequired,
  retailPrice: PropTypes.string.isRequired,
  handleDealersPriceChange: PropTypes.func.isRequired,
  handleRetailPriceChange: PropTypes.func.isRequired
};

export default PhonePriceInfo;
</file>

<file path="src/components/phone-selection/PhoneSelectionForm.jsx">
import { useState, useEffect, useRef } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import PhoneBasicInfo from './PhoneBasicInfo';
import PhonePriceInfo from './PhonePriceInfo';
import PhoneColorInfo from './PhoneColorInfo';
import PhoneAdditionalInfo from './PhoneAdditionalInfo';
import usePhoneOptions from './hooks/usePhoneOptions';
import usePhoneCache from './hooks/usePhoneCache';
import { collection, query, where, getDocs } from 'firebase/firestore';
import { db } from '../../firebase/config';
import { 
  formatNumberWithCommas,
  validateImei, 
  validatePrice,
  handleKeyDown, 
  getCurrentDate 
} from './utils/phoneUtils';
import { 
  checkDuplicateImeis, 
  addPhoneToInventory 
} from './services/inventoryService';
import { Search, ArrowRight, CircleAlert } from 'lucide-react';

const PhoneSelectionForm = () => {
  // ====== STATE DEFINITIONS ======
  // Core state for selections
  const [selectedManufacturer, setSelectedManufacturer] = useState('');
  const [selectedModel, setSelectedModel] = useState('');
  const [selectedColor, setSelectedColor] = useState('');
  const [selectedStorage, setSelectedStorage] = useState('');
  const [selectedRam, setSelectedRam] = useState('');
  
  // Barcode search
  const [barcodeSearch, setBarcodeSearch] = useState('');
  const [isBarcodeSearching, setIsBarcodeSearching] = useState(false);
  const [barcodeSearchError, setBarcodeSearchError] = useState('');
  
  // Get options and loading state from custom hook
  const { 
    manufacturers, 
    models, 
    colors, 
    storage, 
    ram, 
    loading: optionsLoading, 
    error: optionsError,
    fetchManufacturers,
    fetchModels,
    fetchOptions
  } = usePhoneOptions();
  
  // Get price cache from custom hook
  const {
    priceCache,
    setPriceCache,
    loadPriceCacheFromInventory,
    updatePriceConfiguration
  } = usePhoneCache();
  
  // Track previous selection to avoid overwriting user edits
  const prevSelectionRef = useRef('');
  const prevColorRef = useRef('');
  
  // Form input fields state
  const [imei1, setImei1] = useState('');
  const [imei2, setImei2] = useState('');
  const [barcode, setBarcode] = useState('');
  const [dealersPrice, setDealersPrice] = useState('');
  const [retailPrice, setRetailPrice] = useState('');
  const [status, setStatus] = useState('On-Hand');
  
  // UI state
  const [error, setError] = useState(null);
  const [loading, setLoading] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [isSpecsSelected, setIsSpecsSelected] = useState(false);
  const [isCheckingImei, setIsCheckingImei] = useState(false);
  const [imei1Error, setImei1Error] = useState('');
  const [imei2Error, setImei2Error] = useState('');
  const [lastUpdated, setLastUpdated] = useState(getCurrentDate());
  const [userEnteredBarcode, setUserEnteredBarcode] = useState(false);

  // ====== EVENT HANDLERS ======
  // Event handlers for form inputs
  const handleManufacturerChange = (e) => {
    const newManufacturer = e.target.value;
    setSelectedManufacturer(newManufacturer);
    setSelectedModel('');
    setSelectedColor('');
    setSelectedStorage('');
    setSelectedRam('');
    setDealersPrice('');
    setRetailPrice('');
    
    if (newManufacturer) {
      fetchModels(newManufacturer);
    }
  };

  const handleModelChange = (e) => {
    const newModel = e.target.value;
    setSelectedModel(newModel);
    setSelectedColor('');
    setSelectedStorage('');
    setSelectedRam('');
    setDealersPrice('');
    setRetailPrice('');
    
    if (selectedManufacturer && newModel) {
      fetchOptions(selectedManufacturer, newModel);
    }
  };

  const handleColorChange = (e) => {
    setSelectedColor(e.target.value);
    // Reset user entered flag when color changes
    setUserEnteredBarcode(false);
  };

  const handleRamChange = (e) => {
    const newRam = e.target.value;
    setSelectedRam(newRam);
    // We're not automatically setting prices here anymore
  };

  const handleStorageChange = (e) => {
    const newStorage = e.target.value;
    setSelectedStorage(newStorage);
    // We're not automatically setting prices here anymore
  };

  const handleImei1Change = (e) => {
    const newImei = validateImei(e.target.value);
    setImei1(newImei);
    setImei1Error(''); // Clear error on change
  };

  const handleImei2Change = (e) => {
    const newImei = validateImei(e.target.value);
    setImei2(newImei);
    setImei2Error(''); // Clear error on change
  };

  const handleBarcodeChange = (e) => {
    const newBarcode = e.target.value.toUpperCase();
    setBarcode(newBarcode);
    // Set flag that user has entered a barcode manually
    setUserEnteredBarcode(true);
    
    // Add to cache if we have a valid model, RAM, storage, and color
    if (selectedManufacturer && selectedModel && selectedRam && selectedStorage && selectedColor) {
      const cacheKey = `${selectedManufacturer}_${selectedModel}_${selectedRam}_${selectedStorage}_${selectedColor}`;
      setPriceCache(prev => ({
        ...prev,
        [cacheKey]: {
          ...prev[cacheKey],
          barcode: newBarcode,
          lastUpdated: getCurrentDate()
        }
      }));
    }
  };

  const handleBarcodeSearchChange = (e) => {
    setBarcodeSearch(e.target.value.toUpperCase());
    setBarcodeSearchError('');
  };

  const handleBarcodeSearchKeyDown = (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      handleBarcodeSearch();
    }
  };
  
  // Handle barcode search
  const handleBarcodeSearch = async () => {
    if (!barcodeSearch.trim()) {
      setBarcodeSearchError('Please enter a barcode to search');
      return;
    }
    
    setIsBarcodeSearching(true);
    setBarcodeSearchError('');
    
    try {
      // Search for the barcode in inventory
      const inventoryRef = collection(db, 'inventory');
      const q = query(
        inventoryRef, 
        where("barcode", "==", barcodeSearch.trim())
      );
      const snapshot = await getDocs(q);
      
      if (snapshot.empty) {
        setBarcodeSearchError('No matching phone found for this barcode');
        setIsBarcodeSearching(false);
        return;
      }
      
      // Get the first matching record
      const matchingPhone = snapshot.docs[0].data();
      
      // Set all the fields accordingly
      setSelectedManufacturer(matchingPhone.manufacturer);
      
      // Fetch models for this manufacturer
      await fetchModels(matchingPhone.manufacturer);
      
      setSelectedModel(matchingPhone.model);
      
      // Fetch options for this model
      await fetchOptions(matchingPhone.manufacturer, matchingPhone.model);
      
      setSelectedRam(matchingPhone.ram);
      setSelectedStorage(matchingPhone.storage);
      setSelectedColor(matchingPhone.color);
      
      // Set prices
      setDealersPrice(formatNumberWithCommas(matchingPhone.dealersPrice.toString()));
      setRetailPrice(formatNumberWithCommas(matchingPhone.retailPrice.toString()));
      
      // Set barcode
      setBarcode(matchingPhone.barcode);
      setUserEnteredBarcode(true); // Treat this as a user-confirmed barcode
      
      // Everything is selected at this point
      setIsSpecsSelected(true);
      
      // Clear the barcode search
      setBarcodeSearch('');
      
      // Clear IMEI fields (these should be empty for a new entry)
      setImei1('');
      setImei2('');
      
      // Set status and last updated
      setStatus('On-Hand');
      setLastUpdated(getCurrentDate());
      
    } catch (error) {
      console.error("Error searching by barcode:", error);
      setBarcodeSearchError('Error searching for barcode. Please try again.');
    } finally {
      setIsBarcodeSearching(false);
    }
  };

  // Pricing input handlers with commas that work correctly
  const handleDealersPriceChange = (e) => {
    const rawValue = e.target.value;
    
    // Check if input is empty and store as-is if it is
    if (rawValue === '') {
      setDealersPrice('');
    } else {
      // Apply formatting if not empty
      const validatedPrice = validatePrice(rawValue);
      const formattedPrice = formatNumberWithCommas(validatedPrice);
      setDealersPrice(formattedPrice);
    }
  };

  const handleRetailPriceChange = (e) => {
    const rawValue = e.target.value;
    
    // Check if input is empty and store as-is if it is
    if (rawValue === '') {
      setRetailPrice('');
    } else {
      // Apply formatting if not empty
      const validatedPrice = validatePrice(rawValue);
      const formattedPrice = formatNumberWithCommas(validatedPrice);
      setRetailPrice(formattedPrice);
    }
  };

  const handleStatusChange = (e) => {
    const newStatus = e.target.value;
    setStatus(newStatus);
    setLastUpdated(getCurrentDate());
  };

  // Form submission handler
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    // Basic form validation
    if (!selectedManufacturer || !selectedModel || !selectedRam || 
        !selectedStorage || !selectedColor || !imei1 || !barcode || 
        !dealersPrice || !retailPrice) {
      alert('Please fill in all required fields');
      return;
    }
    
    // Set checking state and clear previous errors
    setIsSubmitting(true);
    setIsCheckingImei(true);
    setImei1Error('');
    setImei2Error('');
    
    // Check for duplicate IMEIs before submitting
    const imeisCheck = await checkDuplicateImeis(imei1, imei2);
    
    setIsCheckingImei(false);
    
    if (!imeisCheck.isValid) {
      setImei1Error(imeisCheck.imei1Error);
      setImei2Error(imeisCheck.imei2Error);
      setIsSubmitting(false);
      return; // Don't proceed if IMEIs are invalid
    }
    
    // Update lastUpdated on submit
    const currentDate = getCurrentDate();
    setLastUpdated(currentDate);
    
    // Parse prices properly removing commas
    const dPrice = parseFloat(dealersPrice.replace(/,/g, '')) || 0;
    const rPrice = parseFloat(retailPrice.replace(/,/g, '')) || 0;
    
    const phoneData = {
      manufacturer: selectedManufacturer,
      model: selectedModel,
      color: selectedColor,
      ram: selectedRam,
      storage: selectedStorage,
      imei1,
      imei2,
      barcode,
      dealersPrice: dPrice,
      retailPrice: rPrice,
      status,
      lastUpdated: currentDate,
      dateAdded: currentDate  // New field to track when the entry was first added
    };
    
    setLoading(true);
    
    try {
      // Add the phone to inventory
      const result = await addPhoneToInventory(phoneData);
      
      if (!result.success) {
        throw new Error(result.error || 'Failed to add phone to inventory');
      }
      
      // IMPORTANT: Update the price configuration
      // 1. First update base price (without color)
      await updatePriceConfiguration(
        selectedManufacturer,
        selectedModel,
        selectedRam,
        selectedStorage,
        dealersPrice,
        retailPrice
      );
      
      // 2. Then update color-specific price if different from base price
      await updatePriceConfiguration(
        selectedManufacturer,
        selectedModel,
        selectedRam,
        selectedStorage,
        dealersPrice,
        retailPrice,
        selectedColor
      );
      
      // Update the local cache with the new price configuration
      const basePriceKey = `${selectedManufacturer}_${selectedModel}_${selectedRam}_${selectedStorage}`;
      const colorPriceKey = `${selectedManufacturer}_${selectedModel}_${selectedRam}_${selectedStorage}_${selectedColor}`;
      
      // Update local cache
      setPriceCache(prev => ({
        ...prev,
        [basePriceKey]: {
          ...prev[basePriceKey],
          dealersPrice: dealersPrice,
          retailPrice: retailPrice,
          lastUpdated: currentDate
        },
        [colorPriceKey]: {
          ...prev[colorPriceKey],
          dealersPrice: dealersPrice,
          retailPrice: retailPrice,
          barcode: barcode,
          lastUpdated: currentDate
        }
      }));
            
      // Reset fields after successful submission
      setImei1('');
      setImei2('');
      // Do NOT reset barcode
      // setBarcode('');
      setStatus('On-Hand');
      
      // Set flag that the value should persist
      setUserEnteredBarcode(true);
      
      // Don't reset these:
      // selectedManufacturer, selectedModel, selectedRam,
      // selectedStorage, selectedColor, dealersPrice, or retailPrice
      
      setLoading(false);
      setIsSubmitting(false);
      alert('Phone details saved successfully!');
    } catch (error) {
      console.error("Error adding document:", error);
      setError(`Error saving phone: ${error.message}`);
      setLoading(false);
      setIsSubmitting(false);
      alert('Error saving phone details. Please try again.');
    }
  };

  // ====== EFFECT HOOKS ======
  // Fetch manufacturers on component mount
  useEffect(() => {
    async function initializeForm() {
      setLoading(true);
      try {
        // Fetch manufacturers list
        await fetchManufacturers();
        
        // Fetch existing inventory to build price cache
        await loadPriceCacheFromInventory();
        
        setLoading(false);
      } catch (error) {
        console.error("Error initializing form:", error);
        setError(`Error loading data: ${error.message}`);
        setLoading(false);
      }
    }
    
    initializeForm();
  }, [fetchManufacturers, loadPriceCacheFromInventory]);

  // Check if selections are complete and fetch prices from cache when selections change
  useEffect(() => {
    // First, create a key to track our selections for pricing (without color)
    const priceSelectionKey = `${selectedManufacturer}_${selectedModel}_${selectedRam}_${selectedStorage}`;
    
    // Create a complete key that includes color for barcode lookup
    const barcodeSelectionKey = `${selectedManufacturer}_${selectedModel}_${selectedRam}_${selectedStorage}_${selectedColor}`;
    
    // Track if we need to reset the barcode
    const shouldResetBarcode = prevSelectionRef.current !== priceSelectionKey;
    
    // Only check when we have all the necessary selections
    if (selectedManufacturer && selectedModel && selectedRam && selectedStorage) {
      // Only set the price if selection changed (not when price changed)
      if (shouldResetBarcode) {
        console.log("Selection changed - checking price cache");
        const cacheKey = priceSelectionKey;
        
        if (priceCache[cacheKey]) {
          console.log("Found cached values:", priceCache[cacheKey]);
          if (priceCache[cacheKey].dealersPrice) {
            // Set price from cache
            setDealersPrice(priceCache[cacheKey].dealersPrice);
          }
          if (priceCache[cacheKey].retailPrice) {
            // Set price from cache
            setRetailPrice(priceCache[cacheKey].retailPrice);
          }
        }
      }
      
      // Reset barcode when the base configuration changes (manufacturer, model, RAM, storage)
      if (shouldResetBarcode) {
        setBarcode('');
        setUserEnteredBarcode(false);
      }
      
      // Check for barcode if color is also selected
      if (selectedColor) {
        // Check if color changed - comparing with previous color
        const colorChanged = prevColorRef.current !== selectedColor;
        
        // Only set/clear barcode when color or base selections change, not every render
        if ((shouldResetBarcode || colorChanged) && !userEnteredBarcode) {
          if (priceCache[barcodeSelectionKey] && priceCache[barcodeSelectionKey].barcode) {
            setBarcode(priceCache[barcodeSelectionKey].barcode);
          } else if (colorChanged) {
            // Only clear barcode when color changes and there's no cached barcode for this color
            // AND the user hasn't manually entered a barcode
            setBarcode('');
          }
        }
        
        // If we have a complete selection including color, we can show the additional info section
        setIsSpecsSelected(true);
      } else {
        setIsSpecsSelected(false);
      }
    } else {
      setIsSpecsSelected(false);
    }
    
    // Update the previous selection ref
    prevSelectionRef.current = priceSelectionKey;
    prevColorRef.current = selectedColor;
    // CRITICAL FIX: Removed dealersPrice and retailPrice from the dependency array
    // This prevents the effect from running when price changes
  }, [selectedManufacturer, selectedModel, selectedRam, selectedStorage, selectedColor, priceCache, userEnteredBarcode]);

  // Show loading state for initial load
  if ((loading || optionsLoading) && manufacturers.length === 0) {
    return (
      <div className="min-h-screen bg-white p-4">
        <Card className="w-full max-w-[640px] mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
          <CardHeader className="bg-[rgb(52,69,157)] py-3">
            <CardTitle className="text-2xl text-white">Loading...</CardTitle>
          </CardHeader>
          <CardContent className="p-4">
            <p>Fetching data...</p>
          </CardContent>
        </Card>
      </div>
    );
  }
  
  // Show error state
  if (error || optionsError) {
    const errorMessage = error || optionsError;
    return (
      <div className="min-h-screen bg-white p-4">
        <Card className="w-full max-w-[640px] mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
          <CardHeader className="bg-red-600 py-3">
            <CardTitle className="text-2xl text-white">Error</CardTitle>
          </CardHeader>
          <CardContent className="p-4">
            <p>{errorMessage}</p>
            <button 
              onClick={() => window.location.reload()}
              className="mt-4 px-4 py-2 bg-[rgb(52,69,157)] text-white rounded"
            >
              Reload
            </button>
          </CardContent>
        </Card>
      </div>
    );
  }
  
  // Main component render
  return (
    <div className="min-h-screen bg-white p-4">
      <form 
        onSubmit={handleSubmit}
        onKeyDown={handleKeyDown}>
        <Card className="w-full max-w-[640px] mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
          <CardHeader className="bg-[rgb(52,69,157)] py-3">
            <CardTitle className="text-2xl text-white">Select Phone</CardTitle>
          </CardHeader>

          <CardContent className="bg-white p-4 space-y-4">
            {/* Barcode Search */}
            <div className="p-4 bg-gray-50 rounded-lg border border-gray-200">
              <h3 className="font-semibold text-lg text-[rgb(52,69,157)] mb-3">Quick Barcode Search</h3>
              <div className="flex gap-2">
                <div className="flex-1">
                  <input
                    type="text"
                    value={barcodeSearch}
                    onChange={handleBarcodeSearchChange}
                    onKeyDown={handleBarcodeSearchKeyDown}
                    placeholder="Enter barcode to auto-fill phone details"
                    className="w-full p-2 border rounded"
                  />
                </div>
                <button
                  type="button"
                  onClick={handleBarcodeSearch}
                  disabled={isBarcodeSearching || !barcodeSearch.trim()}
                  className="px-4 py-2 bg-[rgb(52,69,157)] text-white rounded flex items-center"
                >
                  {isBarcodeSearching ? (
                    <span className="animate-spin mr-2"></span>
                  ) : (
                    <Search className="h-5 w-5 mr-2" />
                  )}
                  Search
                </button>
              </div>
              
              {barcodeSearchError && (
                <div className="mt-2 text-red-500 flex items-center">
                  <CircleAlert className="h-4 w-4 mr-1" />
                  {barcodeSearchError}
                </div>
              )}
              
              <div className="mt-2 text-sm text-gray-500 flex items-center">
                <ArrowRight className="h-4 w-4 mr-1" />
                <span>Scan or enter a barcode to automatically fill the phone details</span>
              </div>
            </div>

            {/* Manual Selection Divider */}
            <div className="relative text-center">
              <div className="absolute inset-0 flex items-center">
                <div className="w-full border-t border-gray-300"></div>
              </div>
              <div className="relative flex justify-center">
                <span className="bg-white px-3 text-gray-500 text-sm">Or select manually</span>
              </div>
            </div>

            {/* Basic Information */}
            <PhoneBasicInfo 
              selectedManufacturer={selectedManufacturer}
              selectedModel={selectedModel}
              selectedRam={selectedRam}
              selectedStorage={selectedStorage}
              manufacturers={manufacturers}
              models={models}
              ram={ram}
              storage={storage}
              handleRamChange={handleRamChange}
              handleStorageChange={handleStorageChange}
              handleManufacturerChange={handleManufacturerChange}
              handleModelChange={handleModelChange}
            />

            {/* Price Information */}
            {selectedRam && selectedStorage && (
              <PhonePriceInfo 
                dealersPrice={dealersPrice}
                retailPrice={retailPrice}
                handleDealersPriceChange={handleDealersPriceChange}
                handleRetailPriceChange={handleRetailPriceChange}
              />
            )}

            {/* Color Information */}
            {selectedModel && (
              <PhoneColorInfo 
                selectedColor={selectedColor}
                colors={colors}
                handleColorChange={handleColorChange}
              />
            )}

            {/* Additional Information */}
            {isSpecsSelected && (
              <PhoneAdditionalInfo 
                imei1={imei1}
                imei2={imei2}
                barcode={barcode}
                status={status}
                lastUpdated={lastUpdated}
                handleImei1Change={handleImei1Change}
                handleImei2Change={handleImei2Change}
                handleBarcodeChange={handleBarcodeChange}
                handleStatusChange={handleStatusChange}
                imei1Error={imei1Error}
                imei2Error={imei2Error}
              />
            )}

            {/* Submit Button */}
            <div className="pt-4">
              <button
                type="submit"
                className="w-full py-2 bg-[rgb(52,69,157)] text-white rounded hover:bg-[rgb(52,69,157)]/90"
                disabled={!isSpecsSelected || isCheckingImei || isSubmitting}
              >
                {isSubmitting ? 'Saving...' : 'Save Entry'}
              </button>
            </div>
          </CardContent>
        </Card>
      </form>
    </div>
  );
};

export default PhoneSelectionForm;
</file>

<file path="src/components/phone-selection/services/InventoryService.js">
import { 
    doc, 
    addDoc, 
    collection, 
    query, 
    where, 
    getDocs, 
    runTransaction, 
    increment 
  } from 'firebase/firestore';
  import { db } from '../../../firebase/config';
  import { createInventoryId, getCurrentDate } from '../utils/phoneUtils';
  
  // Check for duplicate IMEIs in the database
  export const checkDuplicateImeis = async (imei1, imei2) => {
    try {
      // Only check if IMEIs are not empty
      let hasError = false;
      let imei1Error = '';
      let imei2Error = '';
      
      // First check if IMEI1 and IMEI2 are the same
      if (imei1 && imei2 && imei1 === imei2) {
        imei2Error = 'IMEI 1 and IMEI 2 cannot be the same';
        hasError = true;
      }
      
      // Only query Firebase if necessary and if there are no other errors
      if (!hasError && imei1) {
        const imei1Query = query(
          collection(db, 'inventory'), 
          where("imei1", "==", imei1)
        );
        const imei1Snapshot = await getDocs(imei1Query);
        
        if (!imei1Snapshot.empty) {
          imei1Error = 'This IMEI already exists in inventory';
          hasError = true;
        }
      }
      
      // Only check IMEI2 if it's not empty and there are no other errors
      if (!hasError && imei2) {
        const imei2Query = query(
          collection(db, 'inventory'), 
          where("imei2", "==", imei2)
        );
        const imei2Snapshot = await getDocs(imei2Query);
        
        if (!imei2Snapshot.empty) {
          imei2Error = 'This IMEI already exists in inventory';
          hasError = true;
        }
      }
      
      return {
        isValid: !hasError,
        imei1Error,
        imei2Error
      };
    } catch (error) {
      console.error("Error checking IMEIs:", error);
      return {
        isValid: false,
        imei1Error: 'Error checking IMEI',
        imei2Error: 'Error checking IMEI'
      };
    }
  };
  
  // Update inventory counts
  export const updateInventory = async (data, isNewPhone = true) => {
    try {
      const { manufacturer, model, ram, storage, color, status } = data;
      
      // Create a unique ID for this inventory item
      const inventoryId = createInventoryId(manufacturer, model, ram, storage, color);
      
      // Reference to the inventory doc
      const inventoryRef = doc(db, 'inventory_counts', inventoryId);
      
      // Run as a transaction to ensure data consistency
      await runTransaction(db, async (transaction) => {
        const inventoryDoc = await transaction.get(inventoryRef);
        
        if (!inventoryDoc.exists()) {
          // This is a new inventory item
          transaction.set(inventoryRef, {
            manufacturer,
            model,
            ram,
            storage,
            color,
            total: 1,
            onHand: status === 'On-Hand' ? 1 : 0,
            onDisplay: status === 'On-Display' ? 1 : 0,
            sold: status === 'Sold' ? 1 : 0,
            reserved: status === 'Reserved' ? 1 : 0,
            defective: status === 'Defective' ? 1 : 0,
            lastUpdated: getCurrentDate()
          });
        } else {
          // Existing inventory item
          const inventoryData = inventoryDoc.data();
          
          // If it's a new phone, increment total and the appropriate status count
          if (isNewPhone) {
            transaction.update(inventoryRef, {
              total: increment(1),
              onHand: status === 'On-Hand' ? increment(1) : inventoryData.onHand,
              onDisplay: status === 'On-Display' ? increment(1) : inventoryData.onDisplay || 0,
              sold: status === 'Sold' ? increment(1) : inventoryData.sold,
              reserved: status === 'Reserved' ? increment(1) : inventoryData.reserved,
              defective: status === 'Defective' ? increment(1) : inventoryData.defective,
              lastUpdated: getCurrentDate()
            });
          } 
          // If it's a status change, we'll handle it separately
        }
      });
      
      return true;
    } catch (error) {
      console.error("Error updating inventory:", error);
      return false;
    }
  };
  
  // Add a new phone to the inventory
  export const addPhoneToInventory = async (phoneData) => {
    try {
      // First add the phone to the inventory tracking system
      const inventoryUpdated = await updateInventory(phoneData, true);
      
      if (!inventoryUpdated) {
        throw new Error("Failed to update inventory counts");
      }
      
      // Add document to 'inventory' collection for the specific phone
      const docRef = await addDoc(collection(db, 'inventory'), phoneData);
      console.log("Document written with ID: ", docRef.id);
      
      return {
        success: true,
        docId: docRef.id
      };
    } catch (error) {
      console.error("Error adding phone to inventory:", error);
      return {
        success: false,
        error: error.message
      };
    }
  };
</file>

<file path="src/components/phone-selection/utils/phoneUtils.js">
// Get current date in MM/DD/YYYY format
export function getCurrentDate() {
    const today = new Date();
    const month = today.getMonth() + 1; // getMonth() is zero-based
    const day = today.getDate();
    const year = today.getFullYear();
    return `${month}/${day}/${year}`;
  }
  
  // Calculate markup percentage
  export const calculateMarkup = (dealersPrice, retailPrice) => {
    const dPrice = parseFloat(dealersPrice.replace(/,/g, '')) || 0;
    const rPrice = parseFloat(retailPrice.replace(/,/g, '')) || 0;
    
    if (dPrice <= 0) return '0.00';
    
    const markup = ((rPrice - dPrice) / dPrice) * 100;
    return markup.toFixed(2);
  };
  
  // Calculate profit amount
  export const calculateProfit = (dealersPrice, retailPrice) => {
    const dPrice = parseFloat(dealersPrice.replace(/,/g, '')) || 0;
    const rPrice = parseFloat(retailPrice.replace(/,/g, '')) || 0;
    
    const profit = rPrice - dPrice;
    return profit.toFixed(2);
  };
  
  // Format numbers with commas
  export const formatNumberWithCommas = (value) => {
    // Remove any non-digits except for decimal point
    const cleanValue = value.replace(/[^\d.]/g, '');
    
    // If there's no decimal point, format with commas
    if (!cleanValue.includes('.')) {
      return cleanValue.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    
    // Split at decimal point and format the whole number part
    const parts = cleanValue.split('.');
    parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    
    // Join back with decimal point and limit to 2 decimal places
    return parts[0] + (parts.length > 1 ? '.' + parts[1].slice(0, 2) : '');
  };
  
  // Validation function for IMEI
  export const validateImei = (value) => {
    // Only allow digits, max 15 characters
    return value.replace(/[^\d]/g, '').slice(0, 15);
  };
  
  // Validation function for price
  export const validatePrice = (value) => {
    // Only allow digits and one decimal point
    return value.replace(/[^\d.]/g, '').replace(/(\..*)\./g, '$1');
  };
  
  // Create a unique inventory ID
  export const createInventoryId = (manufacturer, model, ram, storage, color) => {
    return `${manufacturer}_${model}_${ram}_${storage}_${color}`.replace(/\s+/g, '_').toLowerCase();
  };
  
  // Parse price value for filters
  export const parsePrice = (value) => {
    if (!value) return '';
    return value.replace(/,/g, '');
  };
  
  // Helper to prevent form submission on Enter key
  export const handleKeyDown = (e) => {
    // Prevent Enter key from submitting the form
    if (e.key === 'Enter') {
      e.preventDefault();
    }
  };
</file>

<file path="src/components/PhoneListForm.jsx">
import { useState, useEffect, useCallback } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { collection, getDocs, query, orderBy } from 'firebase/firestore';
import { db } from '../firebase/config';
import { Smartphone, RefreshCw, Search, Filter, X, Eye, SlidersHorizontal, Edit } from 'lucide-react';
import PhoneDetailModal from './phone-list/PhoneDetailModal';
import PhoneAdvancedSearch from './phone-list/PhoneAdvancedSearch';
import { useGlobalState } from '../context/GlobalStateContext';

const PhoneListForm = () => {
  // Get global state functions
  const { editPhone } = useGlobalState();
  
  // State for phones data
  const [phones, setPhones] = useState([]);
  const [filteredPhones, setFilteredPhones] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [sortField, setSortField] = useState('manufacturer');
  const [sortDirection, setSortDirection] = useState('asc');
  
  // State for filters
  const [filters, setFilters] = useState({
    manufacturer: '',
    searchTerm: ''
  });
  
  // Filter options
  const [manufacturers, setManufacturers] = useState([]);
  
  // Show/hide filters
  const [showFilters, setShowFilters] = useState(true);
  
  // Advanced search modal state
  const [isAdvancedSearchOpen, setIsAdvancedSearchOpen] = useState(false);
  const [advancedSearchCriteria, setAdvancedSearchCriteria] = useState(null);
  
  // Detail modal state
  const [isDetailModalOpen, setIsDetailModalOpen] = useState(false);
  const [selectedPhone, setSelectedPhone] = useState(null);

  // Apply filters function defined before fetchPhones to avoid dependency issues
  const applyFilters = useCallback((phonesData) => {
    let filtered = [...phonesData];
    
    // Apply basic filters
    // Apply manufacturer filter
    if (filters.manufacturer) {
      filtered = filtered.filter(phone => 
        phone.manufacturer === filters.manufacturer
      );
    }
    
    // Apply search term filter (search across multiple fields)
    if (filters.searchTerm) {
      const searchLower = filters.searchTerm.toLowerCase();
      filtered = filtered.filter(phone => 
        phone.manufacturer?.toLowerCase().includes(searchLower) ||
        phone.model?.toLowerCase().includes(searchLower) ||
        phone.chipset?.toLowerCase().includes(searchLower) ||
        phone.display?.toLowerCase().includes(searchLower) ||
        (Array.isArray(phone.colors) && phone.colors.some(color => 
          color.toLowerCase().includes(searchLower)
        ))
      );
    }
    
    // Apply advanced search criteria if present
    if (advancedSearchCriteria) {
      // Manufacturer filter (if not already applied in basic filters)
      if (advancedSearchCriteria.manufacturer && !filters.manufacturer) {
        filtered = filtered.filter(phone => 
          phone.manufacturer === advancedSearchCriteria.manufacturer
        );
      }
      
      // Model filter
      if (advancedSearchCriteria.model) {
        const modelSearch = advancedSearchCriteria.model.toLowerCase();
        filtered = filtered.filter(phone => 
          phone.model?.toLowerCase().includes(modelSearch)
        );
      }
      
      // RAM filter
      if (advancedSearchCriteria.ram) {
        const ramSearch = advancedSearchCriteria.ram.toLowerCase();
        filtered = filtered.filter(phone => 
          Array.isArray(phone.storage_extra) && 
          phone.storage_extra.some(ram => ram.toLowerCase().includes(ramSearch))
        );
      }
      
      // Storage filter
      if (advancedSearchCriteria.storage) {
        const storageSearch = advancedSearchCriteria.storage.toLowerCase();
        filtered = filtered.filter(phone => 
          Array.isArray(phone.storage) && 
          phone.storage.some(storage => storage.toLowerCase().includes(storageSearch))
        );
      }
      
      // Display filter
      if (advancedSearchCriteria.display) {
        const displaySearch = advancedSearchCriteria.display.toLowerCase();
        filtered = filtered.filter(phone => 
          phone.display?.toLowerCase().includes(displaySearch)
        );
      }
      
      // Chipset filter
      if (advancedSearchCriteria.chipset) {
        const chipsetSearch = advancedSearchCriteria.chipset.toLowerCase();
        filtered = filtered.filter(phone => 
          phone.chipset?.toLowerCase().includes(chipsetSearch) ||
          phone.cpu?.toLowerCase().includes(chipsetSearch)
        );
      }
      
      // Battery range filter
      if (advancedSearchCriteria.battery) {
        // Min battery
        if (advancedSearchCriteria.battery.min) {
          const minBattery = parseInt(advancedSearchCriteria.battery.min);
          if (!isNaN(minBattery)) {
            filtered = filtered.filter(phone => 
              phone.battery >= minBattery
            );
          }
        }
        
        // Max battery
        if (advancedSearchCriteria.battery.max) {
          const maxBattery = parseInt(advancedSearchCriteria.battery.max);
          if (!isNaN(maxBattery)) {
            filtered = filtered.filter(phone => 
              phone.battery <= maxBattery
            );
          }
        }
      }
    }
    
    setFilteredPhones(filtered);
  }, [filters, advancedSearchCriteria]);

  // Fetch phones data
  const fetchPhones = useCallback(async () => {
    setLoading(true);
    setError(null);
    
    try {
      const phonesRef = collection(db, 'phones');
      const q = query(phonesRef, orderBy(sortField, sortDirection));
      const snapshot = await getDocs(q);
      
      const phonesData = [];
      snapshot.forEach(doc => {
        phonesData.push({
          id: doc.id,
          ...doc.data()
        });
      });
      
      // Extract unique manufacturers for filter
      const uniqueManufacturers = [...new Set(phonesData.map(phone => phone.manufacturer))].sort();
      setManufacturers(uniqueManufacturers);
      
      setPhones(phonesData);
      applyFilters(phonesData);
      setLoading(false);
    } catch (error) {
      console.error("Error fetching phones:", error);
      setError(`Error fetching phones: ${error.message}`);
      setLoading(false);
    }
  }, [sortField, sortDirection, applyFilters]); // Added applyFilters dependency here

  // Handle filter change
  const handleFilterChange = (e) => {
    const { name, value } = e.target;
    setFilters(prev => ({
      ...prev,
      [name]: value
    }));
  };

  // Clear all filters
  const clearFilters = () => {
    setFilters({
      manufacturer: '',
      searchTerm: ''
    });
    setAdvancedSearchCriteria(null);
  };
  
  // Handle advanced search
  const handleAdvancedSearch = (criteria) => {
    setAdvancedSearchCriteria(criteria);
    // Clear basic search term to avoid confusion
    setFilters(prev => ({
      ...prev,
      searchTerm: ''
    }));
  };
  
  // Open advanced search modal
  const openAdvancedSearch = () => {
    setIsAdvancedSearchOpen(true);
  };
  
  // Close advanced search modal
  const closeAdvancedSearch = () => {
    setIsAdvancedSearchOpen(false);
  };

  // Handle sort change
  const handleSort = (field) => {
    if (field === sortField) {
      // Toggle direction if same field
      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
    } else {
      // Set new field and default to asc
      setSortField(field);
      setSortDirection('asc');
    }
  };
  
  // Open detail modal for a phone
  const openPhoneDetail = (phone) => {
    setSelectedPhone(phone);
    setIsDetailModalOpen(true);
  };
  
  // Close detail modal
  const closePhoneDetail = () => {
    setIsDetailModalOpen(false);
    setSelectedPhone(null);
  };
  
  // Handle edit phone
  const handleEditPhone = (phone) => {
    console.log("Editing phone:", phone.id);
    editPhone(phone);
    // No need to manually change location, the context will handle this
  };

  // Initial data fetch
  useEffect(() => {
    fetchPhones();
  }, [fetchPhones]);

  // Apply filters when they change
  useEffect(() => {
    if (phones.length > 0) {
      applyFilters(phones);
    }
  }, [filters, phones, applyFilters, advancedSearchCriteria]);

  // Format storage array as string
  const formatStorage = (storageArray) => {
    if (!storageArray || !Array.isArray(storageArray)) return '-';
    return storageArray.join(', ');
  };

  // Format RAM array as string
  const formatRAM = (ramArray) => {
    if (!ramArray || !Array.isArray(ramArray)) return '-';
    return ramArray.join(', ');
  };

  // Main component render
  return (
    <div className="min-h-screen bg-white p-4">
      <Card className="w-full max-w-6xl mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
        <CardHeader className="bg-[rgb(52,69,157)] py-3 flex flex-row justify-between items-center">
          <div className="flex items-center gap-2">
            <Smartphone className="h-6 w-6 text-white" />
            <CardTitle className="text-2xl text-white">Phone Models</CardTitle>
          </div>
          <div className="flex gap-2">
            <button
              onClick={() => setShowFilters(!showFilters)}
              className={`flex items-center gap-1 ${showFilters ? 'bg-white/20 text-white' : 'bg-white text-[rgb(52,69,157)]'} px-4 py-2 rounded text-base font-medium`}
            >
              <Filter className="h-5 w-5 mr-1" />
              <span>Filters</span>
            </button>
            <button
              onClick={openAdvancedSearch}
              className="flex items-center gap-1 bg-white text-[rgb(52,69,157)] px-4 py-2 rounded text-base font-medium"
            >
              <SlidersHorizontal className="h-5 w-5 mr-1" />
              <span>Advanced</span>
            </button>
            <button
              onClick={fetchPhones}
              className="flex items-center gap-1 bg-white text-[rgb(52,69,157)] px-4 py-2 rounded text-base font-medium"
            >
              <RefreshCw className="h-5 w-5 mr-1" />
              <span>Refresh</span>
            </button>
          </div>
        </CardHeader>

        <CardContent className="p-4">
          {/* Filters panel */}
          {showFilters && (
            <div className="mb-6 p-4 bg-gray-50 rounded-lg border">
              <div className="flex justify-between items-center mb-4">
                <div>
                  <h3 className="font-semibold text-lg text-[rgb(52,69,157)]">Filters</h3>
                  {advancedSearchCriteria && (
                    <p className="text-xs text-[rgb(52,69,157)]">Advanced filters active</p>
                  )}
                </div>
                <button 
                  onClick={clearFilters}
                  className="text-gray-500 hover:text-red-500 flex items-center"
                >
                  <X className="h-4 w-4 mr-1" />
                  Clear Filters
                </button>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Manufacturer
                  </label>
                  <select
                    name="manufacturer"
                    value={filters.manufacturer}
                    onChange={handleFilterChange}
                    className="w-full p-2 border rounded"
                  >
                    <option value="">All Manufacturers</option>
                    {manufacturers.map(manufacturer => (
                      <option key={manufacturer} value={manufacturer}>
                        {manufacturer}
                      </option>
                    ))}
                  </select>
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Search
                  </label>
                  <div className="relative">
                    <input
                      type="text"
                      name="searchTerm"
                      value={filters.searchTerm}
                      onChange={handleFilterChange}
                      placeholder="Search phones..."
                      className="w-full p-2 pl-9 border rounded"
                    />
                    <Search className="h-4 w-4 text-gray-400 absolute left-3 top-3" />
                  </div>
                </div>
              </div>
            </div>
          )}
          
          {/* Empty states and content */}
          {!loading && !error && (
            <>
              {phones.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                  <Smartphone className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                  <h3 className="text-lg font-medium text-gray-700 mb-2">No phones found</h3>
                  <p className="text-gray-500 mb-4">There are no phone models in the database yet.</p>
                  <button
                    onClick={() => window.location.href = '#form'}
                    className="px-4 py-2 bg-[rgb(52,69,157)] text-white rounded-md"
                  >
                    Add New Phone
                  </button>
                </div>
              ) : filteredPhones.length === 0 ? (
                <div className="text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300">
                  <Search className="h-12 w-12 text-gray-400 mx-auto mb-4" />
                  <h3 className="text-lg font-medium text-gray-700 mb-2">No matching phones</h3>
                  <p className="text-gray-500 mb-4">Try changing your search criteria or clearing filters.</p>
                  <button
                    onClick={clearFilters}
                    className="px-4 py-2 bg-[rgb(52,69,157)] text-white rounded-md"
                  >
                    Clear All Filters
                  </button>
                </div>
              ) : (
                <div className="overflow-x-auto bg-white rounded-md border">
                  <table className="w-full border-collapse text-sm table-fixed">
                    <thead>
                      <tr className="bg-gray-100">
                        <th 
                          className="border px-4 py-2 text-left cursor-pointer hover:bg-gray-200 w-[11%]"
                          onClick={() => handleSort('manufacturer')}
                        >
                          Manufacturer
                          {sortField === 'manufacturer' && (
                            <span className="ml-1">{sortDirection === 'asc' ? '' : ''}</span>
                          )}
                        </th>
                        <th 
                          className="border px-4 py-2 text-left cursor-pointer hover:bg-gray-200 w-[11%]"
                          onClick={() => handleSort('model')}
                        >
                          Model
                          {sortField === 'model' && (
                            <span className="ml-1">{sortDirection === 'asc' ? '' : ''}</span>
                          )}
                        </th>
                        <th className="border px-4 py-2 text-left w-[10%]">Display</th>
                        <th className="border px-4 py-2 text-left w-[10%]">RAM</th>
                        <th className="border px-4 py-2 text-left w-[12%]">Storage</th>
                        <th className="border px-4 py-2 text-left w-[15%]">CPU/Chipset</th>
                        <th className="border px-4 py-2 text-left w-[10%]">Battery</th>
                        <th className="border px-4 py-2 text-left w-[13%]">Colors</th>
                        <th className="border px-4 py-2 text-center w-[8%]">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      {filteredPhones.map((phone) => (
                        <tr key={phone.id} className="hover:bg-gray-50">
                          <td className="border px-4 py-2">{phone.manufacturer}</td>
                          <td className="border px-4 py-2 font-medium">{phone.model}</td>
                          <td className="border px-4 py-2 truncate max-w-[150px]">{phone.display || '-'}</td>
                          <td className="border px-4 py-2 whitespace-nowrap">{formatRAM(phone.storage_extra)}</td>
                          <td className="border px-4 py-2 whitespace-nowrap">{formatStorage(phone.storage)}</td>
                          <td className="border px-4 py-2 truncate max-w-[200px]">{phone.chipset || phone.cpu || '-'}</td>
                          <td className="border px-4 py-2 whitespace-nowrap">{phone.battery ? `${phone.battery} mAh` : '-'}</td>
                          <td className="border px-4 py-2">
                            <div className="flex flex-wrap gap-1">
                              {Array.isArray(phone.colors) ? (
                                phone.colors.length > 0 ? (
                                  phone.colors.slice(0, 3).map((color, index) => (
                                    <span 
                                      key={index} 
                                      className="inline-block px-2 py-1 text-xs bg-gray-100 rounded"
                                    >
                                      {color}
                                    </span>
                                  ))
                                ) : '-'
                              ) : '-'}
                              {Array.isArray(phone.colors) && phone.colors.length > 3 && (
                                <span className="inline-block px-2 py-1 text-xs bg-gray-100 rounded">
                                  +{phone.colors.length - 3} more
                                </span>
                              )}
                            </div>
                          </td>
                          <td className="border px-4 py-2 text-center">
                            <div className="flex justify-center space-x-3">
                              <button
                                onClick={() => openPhoneDetail(phone)}
                                className="p-1 text-[rgb(52,69,157)] hover:text-[rgb(80,100,200)]"
                                title="View details"
                              >
                                <Eye className="h-5 w-5" />
                              </button>
                              <button
                                onClick={() => handleEditPhone(phone)}
                                className="p-1 text-[rgb(52,69,157)] hover:text-[rgb(80,100,200)]"
                                title="Edit phone"
                              >
                                <Edit className="h-5 w-5" />
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                  
                  <div className="p-4 flex justify-between items-center text-gray-600">
                    <div>
                      Showing {filteredPhones.length} of {phones.length} phones
                    </div>
                    {advancedSearchCriteria && (
                      <div className="text-xs bg-gray-100 px-2 py-1 rounded">
                        Advanced filters applied
                      </div>
                    )}
                  </div>
                </div>
              )}
            </>
          )}
          
          {/* Loading state */}
          {loading && (
            <div className="text-center py-12">
              <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[rgb(52,69,157)]"></div>
              <p className="mt-2 text-gray-600">Loading phones...</p>
            </div>
          )}
          
          {/* Error state */}
          {error && (
            <div className="text-center py-8 text-red-600">
              <p className="mb-2">{error}</p>
              <button
                onClick={fetchPhones}
                className="mt-2 px-4 py-2 bg-[rgb(52,69,157)] text-white rounded"
              >
                Try Again
              </button>
            </div>
          )}
          
          {/* Phone Detail Modal */}
          <PhoneDetailModal 
            isOpen={isDetailModalOpen}
            phone={selectedPhone}
            onClose={closePhoneDetail}
          />
          
          {/* Advanced Search Modal */}
          <PhoneAdvancedSearch
            isOpen={isAdvancedSearchOpen}
            onClose={closeAdvancedSearch}
            onSearch={handleAdvancedSearch}
            manufacturers={manufacturers}
          />
        </CardContent>
      </Card>
    </div>
  );
};

export default PhoneListForm;
</file>

<file path="src/components/PhoneSpecCard.jsx">
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Battery, Camera, Cpu, Monitor, Palette } from 'lucide-react';
import PropTypes from 'prop-types';

const PhoneSpecCard = () => {
  const phoneData = {
    manufacturer: "Samsung",
    model: "Galaxy S25 Ultra",
    released: "February 2025",
    weight: "218g",
    display: "AMOLED (120Hz)",
    resolution: "1440 x 3120 (498 ppi density)",
    protection: "Corning Gorilla Armor 2",
    os: "Android 15",
    chipset: "Qualcom SM8750-AB Snapdragon 8 Elite",
    cpu: "Qualcomm Oryon",
    gpu: "Qualcomm Adreno",
    storageAndRam: "256GB/ 12GB",
    rearCamera: "200MP + 10MP + 50MP + 50MP",
    frontCamera: "12MP",
    battery: "5,000 mAh",
    wiredCharging: "45W",
    wirelessCharging: "25W",
    colors: ["Titanium Silver Blue", "Titanium Black", "Titanium White Silver", "Titanium Gray"]
  };

  const SpecRow = ({ label, value }) => (
    <div className="flex items-center py-0.5">
      <p className="text-[rgb(52,69,157)] w-40 text-base">{label}:</p>
      <p className="text-base">{value}</p>
    </div>
  );
  
  SpecRow.propTypes = {
    label: PropTypes.string.isRequired,
    value: PropTypes.string.isRequired
  };

  return (
    <div className="min-h-screen bg-white p-4">
      <Card className="w-full max-w-[640px] mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
        <CardHeader className="bg-[rgb(52,69,157)] py-3">
          <CardTitle className="text-2xl text-white">
            {phoneData.manufacturer} {phoneData.model}
          </CardTitle>
          <div className="flex gap-2 mt-2">
            <Badge className="bg-white rounded-md px-3 text-base" style={{ color: 'rgb(52,69,157)' }}>
              {phoneData.released}
            </Badge>
            <Badge variant="outline" className="border-white text-white rounded-md px-3 text-base">
              {phoneData.weight}
            </Badge>
          </div>
        </CardHeader>
        <CardContent className="bg-white p-4 space-y-4">
          {/* Display Section */}
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <Monitor className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Display</h3>
            </div>
            <div>
              <SpecRow label="Type" value={phoneData.display} />
              <SpecRow label="Resolution" value={phoneData.resolution} />
              <SpecRow label="Protection" value={phoneData.protection} />
            </div>
          </div>

          {/* Performance Section */}
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <Cpu className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Performance</h3>
            </div>
            <div>
              <SpecRow label="OS" value={phoneData.os} />
              <SpecRow label="Chipset" value={phoneData.chipset} />
              <SpecRow label="CPU" value={phoneData.cpu} />
              <SpecRow label="GPU" value={phoneData.gpu} />
              <SpecRow label="Storage & RAM" value={phoneData.storageAndRam} />
            </div>
          </div>

          {/* Camera Section */}
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <Camera className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Camera</h3>
            </div>
            <div>
              <SpecRow label="Rear Camera" value={phoneData.rearCamera} />
              <SpecRow label="Front Camera" value={phoneData.frontCamera} />
            </div>
          </div>

          {/* Battery Section */}
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <Battery className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Battery</h3>
            </div>
            <div>
              <SpecRow label="Capacity" value={phoneData.battery} />
              <SpecRow label="Wired Charging" value={phoneData.wiredCharging} />
              <SpecRow label="Wireless Charging" value={phoneData.wirelessCharging} />
            </div>
          </div>

          {/* Colors Section */}
          <div className="space-y-1">
            <div className="flex items-center gap-2">
              <Palette className="w-5 h-5 text-[rgb(52,69,157)]" />
              <h3 className="text-lg font-semibold">Available Colors</h3>
            </div>
            <div className="flex flex-wrap gap-2">
              {phoneData.colors.map((color, index) => (
                <Badge 
                  key={index} 
                  variant="outline" 
                  className="rounded-md px-3 text-sm" // Changed from text-base to text-sm
                  style={{ borderColor: 'rgb(52,69,157)', color: 'rgb(52,69,157)' }}
                >
                  {color}
                </Badge>
              ))}
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default PhoneSpecCard;
</file>

<file path="src/components/PhoneSpecForm.jsx">
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Battery, Camera, Cpu, Monitor, Palette, Smartphone } from 'lucide-react';
import { useState, useEffect } from 'react';
import PropTypes from 'prop-types';
import { addDoc, collection, doc, updateDoc } from 'firebase/firestore';
import { db } from '../firebase/config';
import { useGlobalState } from '../context/GlobalStateContext';

// Add capitalizeWords helper function
const capitalizeWords = (str) => {
  if (!str) return '';
  return str
    .split(' ')
    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
    .join(' ');
};

// Helper function to clean and validate numeric input during typing
const validateNumericInput = (value) => {
  if (!value) return '';
  // Only allow digits, one decimal point, and commas in proper positions
  const cleaned = value
    // Remove anything that's not a digit, comma, or decimal
    .replace(/[^0-9,.]|\.(?=.*\.)/g, '')
    // Remove commas that aren't followed by 3 digits
    .replace(/,(?![0-9]{3})/g, '')
    // Remove multiple consecutive commas
    .replace(/,+/g, ',');
    
  return cleaned;
};

// Helper function to process numeric value before saving to Firebase
const processNumericValue = (value) => {
  if (!value) return null;
  // Remove commas and convert to number
  const cleanValue = value.replace(/,/g, '');
  return cleanValue ? Number(cleanValue) : null;
};

const InputField = ({ label, name, value, width = "w-40", onChange }) => (
  <div className="flex items-center py-0.5">
    <p className={`text-[rgb(52,69,157)] ${width} text-base`}>{label}:</p>
    <input
      type="text"
      name={name}
      value={value || ''}
      onChange={onChange}
      className="text-base flex-1 border rounded px-2 py-1"
    />
  </div>
);

const InputFieldWithExtra = ({ label, name, value, extraValue, extraPlaceholder, mainPlaceholder = "", onChange, width = "w-40" }) => (
  <div className="flex items-center py-0.5">
    <p className={`text-[rgb(52,69,157)] ${width} text-base`}>{label}:</p>
    <div className="flex-1 flex gap-2">
      <input
        type="text"
        name={name}
        value={value || ''}
        onChange={onChange}
        className="text-base flex-1 border rounded px-2 py-1"
        placeholder={mainPlaceholder}
      />
      <div className="w-32">
        <input
          type="text"
          name={`${name}_extra`}
          value={extraValue || ''}
          onChange={onChange}
          className="text-base w-full border rounded px-2 py-1"
          placeholder={extraPlaceholder}
        />
      </div>
    </div>
  </div>
);

const InputFieldWithTwoExtras = ({ label, name, value, extraValue, extraValue2, extraPlaceholder, extraPlaceholder2, mainPlaceholder = "", onChange, width = "w-40" }) => (
  <div className="flex items-center py-0.5">
    <p className={`text-[rgb(52,69,157)] ${width} text-base`}>{label}:</p>
    <div className="flex-1 flex gap-2">
      <div className="flex-1">
        <input
          type="text"
          name={name}
          value={value || ''}
          onChange={onChange}
          className="text-base w-full border rounded px-2 py-1" 
          placeholder={mainPlaceholder}
        />
      </div>
      <div className="w-32">
        <input
          type="text"
          name={`${name}_extra`}
          value={extraValue || ''}
          onChange={onChange}
          className="text-base w-full border rounded px-2 py-1"
          placeholder={extraPlaceholder}
        />
      </div>
      <div className="w-32">
        <input
          type="text"
          name={`${name}_extra2`}
          value={extraValue2 || ''}
          onChange={onChange}
          className="text-base w-full border rounded px-2 py-1"
          placeholder={extraPlaceholder2}
        />
      </div>
    </div>
  </div>
);

InputFieldWithExtra.propTypes = {
  label: PropTypes.string.isRequired,
  name: PropTypes.string.isRequired,
  value: PropTypes.string,
  extraValue: PropTypes.string,
  extraPlaceholder: PropTypes.string.isRequired,
  mainPlaceholder: PropTypes.string,
  onChange: PropTypes.func.isRequired,
  width: PropTypes.string
};

InputFieldWithTwoExtras.propTypes = {
  label: PropTypes.string.isRequired,
  name: PropTypes.string.isRequired,
  value: PropTypes.string,
  extraValue: PropTypes.string,
  extraValue2: PropTypes.string,
  extraPlaceholder: PropTypes.string.isRequired,
  extraPlaceholder2: PropTypes.string.isRequired,
  mainPlaceholder: PropTypes.string,
  onChange: PropTypes.func.isRequired,
  width: PropTypes.string
};

InputField.propTypes = {
  label: PropTypes.string.isRequired,
  name: PropTypes.string.isRequired,
  value: PropTypes.string,
  width: PropTypes.string,
  onChange: PropTypes.func.isRequired
};

InputField.defaultProps = {
  width: "w-40"
};

const PhoneSpecForm = () => {
  // Access the global state for editing
  const { phoneToEdit, clearPhoneToEdit } = useGlobalState();

  const [formData, setFormData] = useState({
    manufacturer: "",
    model: "",
    released: "",
    weight: "",    
    display: "",
    resolution: "",
    resolution_extra: "",
    resolution_extra2: "", 
    protection: "",
    os: "",
    chipset: "",
    chipset_extra: "",
    cpu: "",
    gpu: "",
    storage: "",
    storage_extra: "",
    rearCamera: "",
    frontCamera: "",
    battery: "",
    wiredCharging: "",
    wirelessCharging: "",
    colors: ""
  });
  
  // State to track if we're editing an existing phone
  const [isEditing, setIsEditing] = useState(false);
  const [editId, setEditId] = useState(null);
  
  // Update form data when phoneToEdit changes
  useEffect(() => {
    if (phoneToEdit) {
      // We're in edit mode
      setIsEditing(true);
      setEditId(phoneToEdit.id);
      
      // Format the data for the form
      const formattedData = {
        ...phoneToEdit,
        // Convert arrays to comma-separated strings
        storage: Array.isArray(phoneToEdit.storage) ? phoneToEdit.storage.join(', ') : '',
        storage_extra: Array.isArray(phoneToEdit.storage_extra) ? phoneToEdit.storage_extra.join(', ') : '',
        colors: Array.isArray(phoneToEdit.colors) ? phoneToEdit.colors.join(', ') : '',
        
        // Handle potentially undefined numeric values
        battery: phoneToEdit.battery?.toString() || '',
        wiredCharging: phoneToEdit.wiredCharging?.toString() || '',
        wirelessCharging: phoneToEdit.wirelessCharging?.toString() || '',
        weight: phoneToEdit.weight?.toString() || '',
        resolution_extra: phoneToEdit.resolution_extra?.toString() || '',
        resolution_extra2: phoneToEdit.resolution_extra2?.toString() || '',
        chipset_extra: phoneToEdit.chipset_extra?.toString() || ''
      };
      
      setFormData(formattedData);
    } else {
      // Reset edit state when there's no phone to edit
      setIsEditing(false);
      setEditId(null);
    }
  }, [phoneToEdit]);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    
    // List of fields that should be numeric
    const numericFields = [
      'price',
      'chipset_extra', // Benchmark
      'battery',     
      'wiredCharging',
      'wirelessCharging',
      'weight',
      'resolution_extra', // Refresh Rate
      'resolution_extra2', // PPI
    ];
  
    // List of fields that can accept any input (documenting for clarity)
    const freeformFields = [
      'resolution',
      'rearCamera',
      'frontCamera',
      'storage',
      'storage_extra', // RAM
    ];
  
    // List of fields that should be uppercase
    const uppercaseFields = [
      'barcode',
      'display' 
    ];
  
    // If it's a numeric field, validate the input
    if (numericFields.includes(name)) {
      const validatedValue = validateNumericInput(value);
      setFormData(prev => ({
        ...prev,
        [name]: validatedValue
      }));
    } 
    // If it's an uppercase field, convert to uppercase while typing
    else if (uppercaseFields.includes(name)) {
      setFormData(prev => ({
        ...prev,
        [name]: value.toUpperCase()
      }));
    }
    // For freeform fields and all others
    else {
      if (freeformFields.includes(name)) {
        console.log(`Processing freeform field: ${name}`);
      }
      
      setFormData(prev => ({
        ...prev,
        [name]: value
      }));
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      const processedData = {
        ...formData,
        // String capitalizations
        manufacturer: capitalizeWords(formData.manufacturer),
        model: capitalizeWords(formData.model),
        released: capitalizeWords(formData.released),
        protection: capitalizeWords(formData.protection),
        os: capitalizeWords(formData.os),
        chipset: capitalizeWords(formData.chipset),
        cpu: capitalizeWords(formData.cpu),
        gpu: capitalizeWords(formData.gpu),
        // Ensure display is uppercase
        display: formData.display?.toUpperCase() || '',
        
        // Numeric conversions
        chipset_extra: processNumericValue(formData.chipset_extra),
        battery: processNumericValue(formData.battery),
        wiredCharging: processNumericValue(formData.wiredCharging),
        wirelessCharging: processNumericValue(formData.wirelessCharging),
        weight: processNumericValue(formData.weight),
        resolution_extra: processNumericValue(formData.resolution_extra),
        resolution_extra2: processNumericValue(formData.resolution_extra2),

        // Array processing for storage and RAM
        storage: formData.storage
          ? formData.storage.split(',').map(item => item.trim()).filter(item => item !== '')
          : [],
        
        storage_extra: formData.storage_extra
          ? formData.storage_extra.split(',').map(item => item.trim()).filter(item => item !== '')
          : [],

        // Array processing for colors
        colors: formData.colors
          ? formData.colors.split(',').map(color => color.trim()).filter(color => color !== '').map(color => capitalizeWords(color))
          : []
      };
  
      if (isEditing && editId) {
        // Update existing document
        const phoneRef = doc(db, 'phones', editId);
        await updateDoc(phoneRef, processedData);
        console.log("Document updated with ID: ", editId);
      } else {
        // Add new document
        const docRef = await addDoc(collection(db, 'phones'), processedData);
        console.log("Document written with ID: ", docRef.id);
      }
      
      // Clear form after successful submission
      setFormData({
        manufacturer: "",
        model: "",
        released: "",
        weight: "",   
        display: "",
        resolution: "",
        resolution_extra: "",
        resolution_extra2: "", 
        protection: "",
        os: "",
        chipset: "",
        chipset_extra: "",
        cpu: "",
        gpu: "",
        storage: "",
        storage_extra: "",
        rearCamera: "",
        frontCamera: "",
        battery: "",
        wiredCharging: "",
        wirelessCharging: "",
        colors: ""
      });
      
      // Reset edit state
      setIsEditing(false);
      setEditId(null);
      clearPhoneToEdit();
  
      alert(`Phone ${isEditing ? 'updated' : 'added'} successfully!`);
    } catch (error) {
      console.error("Error adding/updating document: ", error);
      alert(`Error ${isEditing ? 'updating' : 'adding'} phone. Please try again.`);
    }
  };
  
  // Handle cancel edit
  const handleCancel = () => {
    // Clear form and exit edit mode
    setFormData({
      manufacturer: "",
      model: "",
      released: "",
      weight: "",   
      display: "",
      resolution: "",
      resolution_extra: "",
      resolution_extra2: "", 
      protection: "",
      os: "",
      chipset: "",
      chipset_extra: "",
      cpu: "",
      gpu: "",
      storage: "",
      storage_extra: "",
      rearCamera: "",
      frontCamera: "",
      battery: "",
      wiredCharging: "",
      wirelessCharging: "",
      colors: ""
    });
    
    setIsEditing(false);
    setEditId(null);
    clearPhoneToEdit();
  };

  return (
    <div className="min-h-screen bg-white p-4">
      <form onSubmit={handleSubmit}>
        <Card className="w-full max-w-[640px] mx-auto rounded-lg overflow-hidden shadow-[0_3px_10px_rgb(0,0,0,0.2)]">
          <CardHeader className="bg-[rgb(52,69,157)] py-3">
            <CardTitle className="text-2xl text-white">
              {isEditing ? 'Edit Phone' : 'Add New Phone'}
            </CardTitle>
          </CardHeader>

          <CardContent className="bg-white p-4 space-y-4">
            {/* Device Info Section */}
            <div className="space-y-1">
              <div className="flex items-center gap-2">
                <Smartphone className="w-6 h-6 text-[rgb(52,69,157)]" />
                <h3 className="text-xl font-semibold">Device Info</h3>
              </div>
              <div>
                <InputField label="Manufacturer" name="manufacturer" value={formData.manufacturer} onChange={handleInputChange} />
                <InputField label="Model" name="model" value={formData.model} onChange={handleInputChange} />
                <InputField label="Release Date" name="released" value={formData.released} onChange={handleInputChange} />
                <InputField label="Weigh (grams)" name="weight" value={formData.weight} onChange={handleInputChange} />                
              </div>
            </div>

            {/* Display Section */}
            <div className="space-y-1">
              <div className="flex items-center gap-2">
                <Monitor className="w-6 h-6 text-[rgb(52,69,157)]" />
                <h3 className="text-xl font-semibold">Display</h3>
              </div>
              <div>
                <InputFieldWithTwoExtras 
                  label="Resolution" 
                  name="resolution" 
                  value={formData.resolution} 
                  extraValue={formData.resolution_extra}
                  extraValue2={formData.resolution_extra2}
                  extraPlaceholder="Refresh Rate"
                  extraPlaceholder2="PPI"
                  onChange={handleInputChange} 
                />
                <InputField label="Type" name="display" value={formData.display} onChange={handleInputChange} />
                <InputField label="Protection" name="protection" value={formData.protection} onChange={handleInputChange} />
              </div>
            </div>

            {/* Performance Section */}
            <div className="space-y-1">
              <div className="flex items-center gap-2">
                <Cpu className="w-6 h-6 text-[rgb(52,69,157)]" />
                <h3 className="text-xl font-semibold">Performance</h3>
              </div>
              <div>
                <InputField label="OS" name="os" value={formData.os} onChange={handleInputChange} />
                <InputFieldWithExtra 
                  label="Chipset" 
                  name="chipset" 
                  value={formData.chipset} 
                  extraValue={formData.chipset_extra}
                  extraPlaceholder="Benchmark"
                  onChange={handleInputChange} 
                />
                <InputField label="CPU" name="cpu" value={formData.cpu} onChange={handleInputChange} />
                <InputField label="GPU" name="gpu" value={formData.gpu} onChange={handleInputChange} />
                
                {/* Custom RAM & Storage field with equal widths and reversed order */}
                <div className="flex items-center py-0.5">
                  <p className="text-[rgb(52,69,157)] w-40 text-base">RAM & Storage:</p>
                  <div className="flex-1 flex gap-2">
                    <div className="w-1/2">
                      <input
                        type="text"
                        name="storage_extra"
                        value={formData.storage_extra || ''}
                        onChange={handleInputChange}
                        className="text-base w-full border rounded px-2 py-1"
                        placeholder="RAM"
                      />
                    </div>
                    <div className="w-1/2">
                      <input
                        type="text"
                        name="storage"
                        value={formData.storage || ''}
                        onChange={handleInputChange}
                        className="text-base w-full border rounded px-2 py-1"
                        placeholder="Storage"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Camera Section */}
            <div className="space-y-1">
              <div className="flex items-center gap-2">
                <Camera className="w-6 h-6 text-[rgb(52,69,157)]" />
                <h3 className="text-xl font-semibold">Camera</h3>
              </div>
              <div>
                <InputField label="Rear Camera" name="rearCamera" value={formData.rearCamera} onChange={handleInputChange} />
                <InputField label="Front Camera" name="frontCamera" value={formData.frontCamera} onChange={handleInputChange} />
              </div>
            </div>

            {/* Battery Section */}
            <div className="space-y-1">
              <div className="flex items-center gap-2">
                <Battery className="w-6 h-6 text-[rgb(52,69,157)]" />
                <h3 className="text-xl font-semibold">Battery</h3>
              </div>
              <div>
                <InputField label="Capacity" name="battery" value={formData.battery} onChange={handleInputChange} />
                <InputField label="Wired Charging" name="wiredCharging" value={formData.wiredCharging} onChange={handleInputChange} />
                <InputField label="Wireless Charging" name="wirelessCharging" value={formData.wirelessCharging} onChange={handleInputChange} />
              </div>
            </div>

            {/* Colors Section */}
            <div className="space-y-1">
              <div className="flex items-center gap-2">
                <Palette className="w-6 h-6 text-[rgb(52,69,157)]" />
                <h3 className="text-xl font-semibold">Available Colors</h3>
              </div>
              <div>
                <InputField 
                  label="Colors" 
                  name="colors" 
                  value={formData.colors} 
                  onChange={handleInputChange}
                  placeholder="Enter colors separated by commas"
                />
              </div>
            </div>

            <div className="pt-4 flex gap-3">
              {isEditing && (
                <button
                  type="button"
                  onClick={handleCancel}
                  className="w-1/3 py-2 bg-gray-400 text-white rounded hover:bg-gray-500"
                >
                  Cancel
                </button>
              )}
              <button
                type="submit"
                className={`${isEditing ? 'w-2/3' : 'w-full'} py-2 bg-[rgb(52,69,157)] text-white rounded hover:bg-[rgb(52,69,157)]/90`}
              >
                {isEditing ? 'Update Phone' : 'Save Phone'}
              </button>
            </div>
          </CardContent>
        </Card>
      </form>
    </div>
  );
};

export default PhoneSpecForm;
</file>

<file path="src/components/ui/badge/index.jsx">
import PropTypes from 'prop-types'
import { cn } from "@/lib/utils"
import { badgeVariants } from './variants'

function Badge({
  className = '',  // Using default parameter instead of defaultProps
  variant = 'default', // Using default parameter instead of defaultProps
  ...props
}) {
  return (
    <div 
      className={cn(badgeVariants({ variant }), className)} 
      {...props} 
    />
  )
}

Badge.propTypes = {
  className: PropTypes.string,
  variant: PropTypes.oneOf(['default', 'secondary', 'destructive', 'outline'])
}

// Remove Badge.defaultProps

export { Badge }
</file>

<file path="src/components/ui/badge/variants.jsx">
import { cva } from "class-variance-authority"

export const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)
</file>

<file path="src/components/ui/card.jsx">
import * as React from "react"
import { cn } from "@/lib/utils"
import PropTypes from 'prop-types'

const Card = React.forwardRef(({ 
  className = '', // Using default parameter
  ...props 
}, ref) => (
  <div
    ref={ref}
    className={cn("rounded-lg border bg-card text-card-foreground shadow-sm", className)}
    {...props}
  />
))
Card.displayName = "Card"
Card.propTypes = {
  className: PropTypes.string
}

const CardHeader = React.forwardRef(({ 
  className = '', // Using default parameter
  ...props 
}, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"
CardHeader.propTypes = {
  className: PropTypes.string
}

const CardTitle = React.forwardRef(({ 
  className = '', // Using default parameter
  ...props 
}, ref) => (
  <h3
    ref={ref}
    className={cn("text-2xl font-semibold leading-none tracking-tight", className)}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"
CardTitle.propTypes = {
  className: PropTypes.string
}

const CardContent = React.forwardRef(({ 
  className = '', // Using default parameter
  ...props 
}, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"
CardContent.propTypes = {
  className: PropTypes.string
}

export { Card, CardHeader, CardTitle, CardContent }
</file>

<file path="src/context/GlobalStateContext.jsx">
// src/context/GlobalStateContext.jsx
import PropTypes from 'prop-types';
import { createContext, useState, useContext } from 'react';

// Create context
export const GlobalStateContext = createContext();

// Custom hook for easier context usage
export const useGlobalState = () => useContext(GlobalStateContext);

// Create provider
export const GlobalStateProvider = ({ children }) => {
  const [phoneToEdit, setPhoneToEdit] = useState(null);
  const [activeComponent, setActiveComponent] = useState('summary'); // Changed back to 'summary'
  
  // Function to set a phone for editing and switch to form
  const editPhone = (phone) => {
    console.log("GlobalStateContext: Setting phone to edit", phone?.id);
    setPhoneToEdit(phone);
    setActiveComponent('form');
  };
  
  // Function to clear the selected phone
  const clearPhoneToEdit = () => {
    setPhoneToEdit(null);
  };
  
  // Create a value object with all the state and functions
  const contextValue = {
    phoneToEdit,
    editPhone,
    clearPhoneToEdit,
    activeComponent,
    setActiveComponent
  };
  
  return (
    <GlobalStateContext.Provider value={contextValue}>
      {children}
    </GlobalStateContext.Provider>
  );
};

// Add prop types for validation
GlobalStateProvider.propTypes = {
  children: PropTypes.node.isRequired
};

// Also provide a default export for the hook for backward compatibility
export default useGlobalState;
</file>

<file path="src/firebase/config.js">
import { initializeApp } from 'firebase/app';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {

    apiKey: "AIzaSyAdj8EwqtB7uP_gQmevelvbxew4_X4LJyk",  
    authDomain: "tech-city-phone-information.firebaseapp.com",  
    projectId: "tech-city-phone-information",  
    storageBucket: "tech-city-phone-information.firebasestorage.app",  
    messagingSenderId: "218177382353",  
    appId: "1:218177382353:web:cf92ab1e75bcd139a062f0"  
};
  

// Initialize Firebase
const app = initializeApp(firebaseConfig);
export const db = getFirestore(app);
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;
</file>

<file path="src/lib/utils.js">
import { clsx } from "clsx"
import { twMerge } from "tailwind-merge"
 
export function cn(...inputs) {
  return twMerge(clsx(inputs))
}
</file>

<file path="src/main.jsx">
// src/main.jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import './index.css';
import './styles.css';
// Import the GlobalStateProvider from our consolidated file
import { GlobalStateProvider } from './context/GlobalStateContext';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <GlobalStateProvider>
      <App />
    </GlobalStateProvider>
  </React.StrictMode>
);
</file>

<file path="src/styles.css">
.test-blue {
    background-color: rgb(52,69,157);
    padding: 20px;
    color: white;
  }
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,jsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: []
}
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { fileURLToPath } from 'url'
import path from 'path'

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  esbuild: {
    loader: "jsx",
    include: /src\/.*\.jsx?$/,
    exclude: [],
  },
})
</file>

</files>
